var EgretExpandManager=function(){function e(){}var t=(__define,e);t.prototype;return e.init=function(){AnchorUtils.init(),TimerManager.init()},e}();egret.registerClass(EgretExpandManager,"EgretExpandManager");var GameCmd=function(){function e(){}var t=(__define,e);t.prototype;return e.GAME_START="game_start",e}();egret.registerClass(GameCmd,"GameCmd");var BaseController=function(){function e(e){this._messages={},this._scene=e}var t=(__define,e),i=t.prototype;return i.registerFunc=function(e,t,i){this._messages[e]=[t,i]},i.applyFunc=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var n=this._messages[e];return n?n[0].apply(n[1],t):(Log.trace("消息"+e+"不存在侦听"),null)},i.applyControllerFunc=function(e,t){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];return ControllerManager.instance.applyFunc.apply(ControllerManager.instance,arguments)},i.setModel=function(e){this._model=e},i.getModel=function(){return this._model},i.getControllerModel=function(e){return ControllerManager.instance.getControllerModel(e)},e}();egret.registerClass(BaseController,"BaseController");var GameController=function(e){function t(t){e.call(this,t),this._model=new GameModel(this),ControllerManager.instance.register(ControllerID.Game,this)}__extends(t,e);var i=__define,n=t,r=n.prototype;return i(r,"model",function(){return this._model}),i(r,"scene",function(){return this._scene}),t}(BaseController);egret.registerClass(GameController,"GameController");var GameData=function(){function e(){}var t=__define,i=e;i.prototype;return t(e,"hor",function(){return 7}),t(e,"ver",function(){return 7}),t(e,"tileSize",function(){return 80}),e.getTileColor=function(e){var t=[0,8243709,16012888,16629567,12023257];return t[e]},e}();egret.registerClass(GameData,"GameData");var BaseModel=function(){function e(e){this._controller=e,this._controller.setModel(this)}var t=(__define,e),i=t.prototype;return i.applyFunc=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return this._controller.applyFunc.apply(this._controller,arguments)},i.applyControllerFunc=function(e,t){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];return this._controller.applyControllerFunc.apply(this._controller,arguments)},e}();egret.registerClass(BaseModel,"BaseModel");var GameModel=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t);i.prototype;return t}(BaseModel);egret.registerClass(GameModel,"GameModel");var BaseScene=function(e){function t(){e.call(this),this._isInit=!1,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),StageUtils.stage.addEventListener(egret.Event.RESIZE,this.onResize,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onAddToStage=function(e){this._isInit||(this.init(),this._isInit=!0)},n.init=function(){},n.onResize=function(){},n.open=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t]},n.close=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t]},n.applyFunc=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return this._controller.applyFunc.apply(this._controller,arguments)},n.applyControllerFunc=function(e,t){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];return this._controller.applyControllerFunc.apply(this._controller,arguments)},n.setVisible=function(e){this.visible=e},t}(egret.DisplayObjectContainer);egret.registerClass(BaseScene,"BaseScene");var GameScene=function(e){function t(){e.call(this),this._controller=new GameController(this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.init=function(){this.addChild(this._grid=new Grid)},n.onResize=function(){var e=StageUtils.stageW,t=StageUtils.stageH;this._grid.x=e/2,this._grid.y=t/2},n.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i-0]=arguments[i];e.prototype.open.call(this),this.onResize(),this.applyControllerFunc(ControllerID.Grid,GameCmd.GAME_START)},n.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i-0]=arguments[i];e.prototype.close.call(this)},t}(BaseScene);egret.registerClass(GameScene,"GameScene");var Grid=function(e){function t(){e.call(this),this._size=560,this._controller=new GridController(this)}__extends(t,e);var i=__define,n=t,r=n.prototype;return r.init=function(){e.prototype.init.call(this),this.addChild(this._tileCon=new egret.DisplayObjectContainer),this.width=this.height=this._size,AnchorUtils.setAnchor(this,.5),StageUtils.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),StageUtils.stage.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEnd,this)},r.createTile=function(e){var t=this,i=e.pos,n=ObjectPool.pop("Tile");n.reset(),n.pos=i.clone();var r=this.getTruePosition(i.x,i.y);n.x=r.x,n.y=r.y,n.type=e.type,n.effect=e.effect,n.touchEnabled=!0,this._tileCon.addChild(n),n.setOnTouch(function(){t.tileOnTouch(n.pos)})},r.removeTile=function(e,t){var i=this.findTile(e.pos);i&&i.remove(t)},r.selectTile=function(e){var t=this.findTile(e.pos);t&&t.select()},r.unselectTile=function(e){var t=this.findTile(e.pos);t&&t.unselect()},r.moveTile=function(e){var t=e.tileData,i=e.target,n=e.duration,r=this.findTile(t.pos);if(r){var s=this.getTruePosition(i.x,i.y);r.moveTo(s,n,function(){r.pos=i.clone()})}},r.changeTileEffect=function(e){var t=this.findTile(e.pos);t&&(t.effect=e.effect)},r.changeTileType=function(e){var t=this.findTile(e.pos);t&&(t.type=e.type)},r.tileOnTouch=function(e){this.applyFunc(GridCmd.TOUCH_TILE,e)},r.onEnd=function(e){this.applyFunc(GridCmd.TOUCH_END)},r.findTile=function(e){for(var t=0;t<this._tileCon.numChildren;t++){var i=this._tileCon.getChildAt(t);if(i.pos.equalTo(e))return i}},r.getTruePosition=function(e,t){var e=e*this._size/this.hor,t=t*this._size/this.ver;return new Vector2(e,t)},i(r,"hor",function(){return GameData.hor}),i(r,"ver",function(){return GameData.ver}),t}(BaseScene);egret.registerClass(Grid,"Grid");var GridCmd=function(){function e(){}var t=(__define,e);t.prototype;return e.TOUCH_TILE="touch_tile",e.TOUCH_END="touch_end",e.TILE_CREATE="tile_create",e.TILE_REMOVE="tile_remove",e.TILE_SELECT="tile_select",e.TILE_UNSELECT="tile_unselect",e.TILE_MOVE="tile_move",e.TILE_CHANGE_EFFECT="tile_change_effect",e.TILE_CHANGE_TYPE="tile_change_type",e}();egret.registerClass(GridCmd,"GridCmd");var GridController=function(e){function t(t){e.call(this,t),this._model=new GridModel(this),ControllerManager.instance.register(ControllerID.Grid,this),this.registerFunc(GameCmd.GAME_START,this.start,this),this.registerFunc(GridCmd.TOUCH_TILE,this.touchTile,this),this.registerFunc(GridCmd.TOUCH_END,this.touchEnd,this),this.registerFunc(GridCmd.TILE_CREATE,this.createTile,this),this.registerFunc(GridCmd.TILE_REMOVE,this.removeTile,this),this.registerFunc(GridCmd.TILE_SELECT,this.selectTile,this),this.registerFunc(GridCmd.TILE_UNSELECT,this.unselectTile,this),this.registerFunc(GridCmd.TILE_MOVE,this.moveTile,this),this.registerFunc(GridCmd.TILE_CHANGE_EFFECT,this.changeTileEffect,this),this.registerFunc(GridCmd.TILE_CHANGE_TYPE,this.changeTileType,this)}__extends(t,e);var i=__define,n=t,r=n.prototype;return r.start=function(){this.model.start()},r.touchTile=function(e){this.model.touchTile(e)},r.touchEnd=function(){this.model.touchEnd()},r.createTile=function(e){this.scene.createTile(e)},r.removeTile=function(e,t){this.scene.removeTile(e,t)},r.selectTile=function(e){this.scene.selectTile(e)},r.unselectTile=function(e){this.scene.unselectTile(e)},r.moveTile=function(e){this.scene.moveTile(e)},r.changeTileEffect=function(e){this.scene.changeTileEffect(e)},r.changeTileType=function(e){this.scene.changeTileType(e)},i(r,"model",function(){return this._model}),i(r,"scene",function(){return this._scene}),t}(BaseController);egret.registerClass(GridController,"GridController");var GridModel=function(e){function t(){e.apply(this,arguments),this._interval=50}__extends(t,e);var i=__define,n=t,r=n.prototype;return r.start=function(){this.setState(GridState.Start),this._hor=GameData.hor,this._ver=GameData.ver,this._selectArr=[],this.initTileList()},r.touchTile=function(e){var t=this.getTile(e.x,e.y),i=this._selectArr.length;if(this.isState(GridState.Idle))this._selectArr=[t],this.select(t),this.setState(GridState.Select);else if(this.isState(GridState.Select)&&i&&(0==this.curSelectType||0==t.type||this.curSelectType==t.type)){var n=this._selectArr.indexOf(t),r=this._selectArr[i-1];0>n&&t.pos.borderUpon(r.pos)?(this._selectArr.push(t),this.select(t)):n==i-2&&(ArrayUtils.remove(this._selectArr,r),this.unselect(r))}},r.touchEnd=function(){if(this._selectArr.length>=3)this.remove();else{for(var e=0;e<this._selectArr.length;e++)this.unselect(this._selectArr[e]);this.setState(GridState.Idle)}this._selectArr=[]},r.remove=function(){var e=this;this.setState(GridState.Remove);for(var t=0,i=this._selectArr.length,n=0;i>n;n++){var r=this._selectArr[n],s=r.pos.x,o=r.pos.y;t=this.delTile(s,o)}var a=this._selectArr[i-1].pos.clone();TimerManager.doTimer(t+this._interval,1,function(){e.addEffect(i,a),e.repair()},this)},r.addEffect=function(e,t){var i;e>=20?i=TileEffect.RANDOM:e>=14?i=TileEffect.KIND:e>=7?i=TileEffect.CROSS:e>=4&&(i=TileEffect.BOMB),i&&(this._tileList[t.x][t.y]=this.addTile(t.x,t.y,0,i))},r.repair=function(){for(var e=this,t=[],i=[],n=0;n<this._hor;n++){var r=[];t.push(r);for(var s=0;s<this._ver;s++)null==this._tileList[n][s]&&r.push(s)}for(var n=0;n<t.length;n++){var o=t[n];o.sort(SortUtils.sortNum);for(var a=0;a<o.length;a++){var h=this.addTile(n,a-o.length);i.push(this.moveTile(h,new Vector2(n,a)))}for(var s=0;s<this._ver;s++)if(s<o[0])i.push(this.moveTile(this.getTile(n,s),new Vector2(n,s+o.length)));else if(o.shift(),0==o.length)break}var l=this.getMaxMoveDuration(i);TimerManager.doTimer(l+this._interval,1,function(){e.updateMovePosition(i),e.setState(GridState.Idle)},this)},r.doEffect=function(e){var t=e.pos.x,i=e.pos.y,n=this._hor,r=this._ver;switch(e.effect){case TileEffect.BOMB:for(var s=Math.max(0,t-1),o=Math.min(n,t+2),a=Math.max(0,i-1),h=Math.min(r,i+2),l=s;o>l;l++)for(var c=a;h>c;c++)this.delTile(l,c);break;case TileEffect.CROSS:for(var l=0;n>l;l++)this.delTile(l,i);for(var l=0;r>l;l++)this.delTile(t,l);break;case TileEffect.KIND:for(var u=this.curSelectType,l=0;n>l;l++)for(var c=0;n>c;c++){var f=this.getTile(l,c);f&&f.type==u&&this.delTile(l,c)}break;case TileEffect.RANDOM:for(var g=[],l=0;n>l;l++)for(var c=0;n>c;c++){var f=this.getTile(l,c);f&&g.push(f)}g.sort(SortUtils.random);var d=RandomUtils.limitInteger(22,25);d=Math.min(g.length,d);for(var l=0;d>l;l++)this.delTile(g[l].pos.x,g[l].pos.y)}},r.initTileList=function(){this._tileList=[];for(var e=0;e<this._hor;e++){var t=[];this._tileList.push(t);for(var i=0;i<this._ver;i++)t.push(this.addTile(e,i))}},r.addTile=function(e,t,i,n){void 0===i&&(i=null),void 0===n&&(n=null);var r=new TileData;return r.pos=new Vector2(e,t),r.type=null==i?this.randomType():i,r.effect=n||TileEffect.NONE,this.creatTile(r),r},r.delTile=function(e,t){var i=300,n=this.getTile(e,t);return n&&(this._tileList[e][t]=null,this.removeTile(n,i),n.effect!=TileEffect.NONE&&this.doEffect(n)),i},r.creatTile=function(e){this.applyFunc(GridCmd.TILE_CREATE,e)},r.removeTile=function(e,t){this.applyFunc(GridCmd.TILE_REMOVE,e,t)},r.select=function(e){this.applyFunc(GridCmd.TILE_SELECT,e)},r.unselect=function(e){this.applyFunc(GridCmd.TILE_UNSELECT,e)},r.changeRandomTileEffect=function(e,t){for(var i=this.getRandomTile();i.effect!=e;)i=this.getRandomTile();i.effect=t,this.applyFunc(GridCmd.TILE_CHANGE_EFFECT,i)},r.getRandomTile=function(){var e=RandomUtils.limitInteger(0,this._hor-1),t=RandomUtils.limitInteger(0,this._ver-1);return this._tileList[e][t]},r.moveTile=function(e,t){var i=this.cacuMoveTime(e.pos,t),n=new MoveInfo(e,t,i);return this.applyFunc(GridCmd.TILE_MOVE,n),n},r.getMaxMoveDuration=function(e){for(var t=0,i=0;i<e.length;i++)t=Math.max(t,e[i].duration);return t},r.cacuMoveTime=function(e,t){return 200*Math.abs(e.y-t.y)},r.updateMovePosition=function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].tileData.clone());for(var i=0;i<e.length;i++){var n=e[i];t[i].pos=n.target.clone(),this._tileList[n.target.x][n.target.y]=t[i]}},r.getTile=function(e,t){return this._tileList[e][t]},r.randomType=function(){return RandomUtils.limitInteger(1,4)},i(r,"curSelectType",function(){for(var e=0,t=0;t<this._selectArr.length&&(e=this._selectArr[t].type,0==e);t++);return e}),r.setState=function(e){this._state=e},r.isState=function(e){return this._state==e},t}(BaseModel);egret.registerClass(GridModel,"GridModel");var GridState;!function(e){e[e.Start=0]="Start",e[e.Idle=1]="Idle",e[e.Select=2]="Select",e[e.Remove=3]="Remove",e[e.REPAIR=4]="REPAIR"}(GridState||(GridState={}));var Tile=function(e){function t(){e.call(this),this.addChild(this._sprite=new egret.Sprite),this.addChild(this._selectEffect=new egret.Sprite),this.addChild(this._effectSprte=new egret.Sprite),this.width=this.height=this.size,this._sprite.x=this._sprite.y=this._selectEffect.x=this._selectEffect.y=this._effectSprte.x=this._effectSprte.y=this.size/2,this.addTouch()}__extends(t,e);var i=__define,n=t,r=n.prototype;return r.reset=function(){this._sprite.scaleX=this._sprite.scaleY=1,this._sprite.alpha=1,this._effectSprte.scaleX=this._effectSprte.scaleY=1,this._effectSprte.alpha=1,this._selectEffect.visible=!1},r.addTouch=function(){var e=this.size,t=6*e/7,i=new egret.Sprite;DrawUtils.drawRect(i,t,t,16777215),i.alpha=0,i.x=e/2,i.y=e/2,AnchorUtils.setAnchor(i,.5),this.addChild(i),i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),i.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouch,this),this._touch=i},r.onTouch=function(){this._callBack&&this._callBack()},r.setOnTouch=function(e){this._callBack=e},r.select=function(){var e=this._selectEffect;egret.Tween.removeTweens(e),e.visible=!0,e.scaleX=e.scaleY=1,e.alpha=.6,egret.Tween.get(e).to({scaleX:2.5,scaleY:2.5,alpha:.1},400,egret.Ease.sineIn).call(function(){e.visible=!1});var t=this._sprite;egret.Tween.get(t).to({scaleX:1.5,scaleY:1.5,alpha:.5},200)},r.unselect=function(){var e=this._sprite;egret.Tween.get(e).to({scaleX:1,scaleY:1,alpha:1},200)},r.remove=function(e){var t=this;egret.Tween.get(this._sprite).to({scaleX:.2,scaleY:.2},e).call(function(){DisplayUtils.removeFromParent(t),ObjectPool.push(t)}),this._effect},r.moveTo=function(e,t,i){void 0===i&&(i=null),egret.Tween.get(this).to({x:e.x,y:e.y},t,egret.Ease.elasticOut).call(function(){i&&i()})},i(r,"type",void 0,function(e){this._type=e;var t=this._sprite,i=this.size,n=3*i/7;DrawUtils.drawRoundRect(t,n,n,n/3,n/3,this.color),AnchorUtils.setAnchor(t,.5);var r=this._selectEffect;DrawUtils.drawRoundRect(r,n,n,n/3,n/3,this.color),r.visible=!1,AnchorUtils.setAnchor(r,.5)}),i(r,"effect",void 0,function(e){this._effect=e;var t=this._effectSprte,i=this.size;switch(this._effect){case TileEffect.NONE:t.graphics.clear();break;case TileEffect.BOMB:DrawUtils.drawCircle(t,i/8,16777215);break;case TileEffect.CROSS:DrawUtils.drawCross(t,i/4,i/20,16777215);break;case TileEffect.KIND:DrawUtils.drawTriangle(t,i/8,i/20,16777215);break;case TileEffect.RANDOM:DrawUtils.drawStar(t,i/8,i/20,16777215)}}),i(r,"pos",function(){return this._pos},function(e){this._pos=e}),i(r,"size",function(){return GameData.tileSize}),i(r,"color",function(){return GameData.getTileColor(this._type)}),t}(egret.DisplayObjectContainer);egret.registerClass(Tile,"Tile");var TileData=function(){function e(){this.effect=TileEffect.NONE}var t=(__define,e),i=t.prototype;return i.clone=function(){var t=new e;return t.pos=this.pos.clone(),t.type=this.type,t.effect=this.effect,t},e}();egret.registerClass(TileData,"TileData");var TileEffect;!function(e){e[e.NONE=0]="NONE",e[e.BOMB=1]="BOMB",e[e.CROSS=2]="CROSS",e[e.KIND=3]="KIND",e[e.RANDOM=4]="RANDOM"}(TileEffect||(TileEffect={}));var Main=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),EgretExpandManager.init(),StageUtils.stage.removeChildren(),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},n.onResourceLoadComplete=function(e){"preload"==e.groupName?(this._loadingScene=SceneManager.instance.open(SceneID.Loading),RES.loadGroup("loading")):"loading"==e.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},n.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},n.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},n.onResourceProgress=function(e){"loading"==e.groupName&&this._loadingScene.setProgress(e.itemsLoaded,e.itemsTotal)},n.createGameScene=function(){SceneManager.instance.close(SceneID.Loading),SceneManager.instance.open(SceneID.Game)},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var MoveInfo=function(){function e(e,t,i){this.tileData=e.clone(),this.target=t,this.duration=i}var t=(__define,e);t.prototype;return e}();egret.registerClass(MoveInfo,"MoveInfo");var Vector2=function(){function e(e,t){this.x=e,this.y=t}var t=(__define,e),i=t.prototype;return i.clone=function(){return new e(this.x,this.y)},i.equalTo=function(e){return e.x==this.x&&e.y==this.y?!0:!1},i.borderUpon=function(e){return Math.abs(e.x-this.x)<=1&&Math.abs(e.y-this.y)<=1?!0:!1},e}();egret.registerClass(Vector2,"Vector2");var LoadingCmd=function(){function e(){}var t=(__define,e);t.prototype;return e.SET_PROGRESS="set_progress",e}();egret.registerClass(LoadingCmd,"LoadingCmd");var LoadingController=function(e){function t(t){e.call(this,t),ControllerManager.instance.register(ControllerID.Loading,this),this.registerFunc(LoadingCmd.SET_PROGRESS,this.setProgress,this)}__extends(t,e);var i=__define,n=t,r=n.prototype;return r.setProgress=function(e,t){this.scene.setProgress(e,t)},i(r,"scene",function(){return this._scene}),t}(BaseController);egret.registerClass(LoadingController,"LoadingController");var LoadingScene=function(e){function t(){e.call(this),this._controller=new LoadingController(this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.setProgress=function(e,t){},n.onResize=function(){},n.open=function(){this.visible=!0},n.close=function(){this.visible=!1},t}(BaseScene);egret.registerClass(LoadingScene,"LoadingScene");var ControllerManager=function(){function e(){this._modules={}}var t=__define,i=e,n=i.prototype;return n.clear=function(){this._modules={}},n.register=function(e,t){this.isExists(e)||(this._modules[e]=t)},n.unregister=function(e){this.isExists(e)&&(this._modules[e]=null,delete this._modules[e])},n.isExists=function(e){return null!=this._modules[e]},n.applyFunc=function(e,t){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];var r=this._modules[e];if(r){for(var s=[],o=1;o<arguments.length;o++)s[o-1]=arguments[o];return r.applyFunc.apply(r,s)}return Log.trace("模块"+e+"不存在"),null},n.getControllerModel=function(e){var t=this._modules[e];return t?t.getModel():null},t(e,"instance",function(){return this._instance||(this._instance=new e)}),e}();egret.registerClass(ControllerManager,"ControllerManager");var ControllerID;!function(e){e[e.Loading=0]="Loading",e[e.Menu=1]="Menu",e[e.Game=2]="Game",e[e.Grid=3]="Grid"}(ControllerID||(ControllerID={}));var SceneManager=function(){function e(){this._opens=[],this._scenes={}}var t=__define,i=e,n=i.prototype;return n.open=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var n=this._scenes[e];if(!n){switch(e){case SceneID.Loading:n=ObjectPool.pop("LoadingScene");break;case SceneID.Menu:n=ObjectPool.pop("MenuScene");break;case SceneID.Game:n=ObjectPool.pop("GameScene");break;default:return void Log.trace("Scene_"+e+"不存在")}this._scenes[e]=n,StageUtils.stage.addChild(n)}return n.open(t),this._opens.indexOf(e)<0&&this._opens.push(e),n},n.close=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(!(this._opens.indexOf(e)<0)){var n=this._scenes[e];n&&(ArrayUtils.remove(this._opens,e),n.close(t))}},n.getScene=function(e){return this._scenes[e]},n.closeAll=function(){for(;this._opens.length;)this.close(this._opens[0])},t(e,"instance",function(){return this._instance||(this._instance=new e)}),e}();egret.registerClass(SceneManager,"SceneManager");var SceneID;!function(e){e[e.Loading=0]="Loading",e[e.Menu=1]="Menu",e[e.Game=2]="Game"}(SceneID||(SceneID={}));var AnchorUtils=function(){function e(){}var t=(__define,e);t.prototype;return e.init=function(){this._propertyChange=Object.create(null),this._anchorChange=Object.create(null),this.injectAnchor()},e.setAnchorX=function(e,t){e.anchorX=t},e.setAnchorY=function(e,t){e.anchorY=t},e.setAnchor=function(e,t){e.anchorX=e.anchorY=t},e.getAnchor=function(e){return e.anchorX!=e.anchorY&&console.log("target's anchorX != anchorY"),e.anchorX||0},e.getAnchorY=function(e){return e.anchorY||0},e.getAnchorX=function(e){return e.anchorX||0},e.injectAnchor=function(){Object.defineProperty(egret.DisplayObject.prototype,"width",{get:function(){return this.$getWidth()},set:function(t){var i=this;this.$setWidth(t),e._propertyChange[this.hashCode]=!0,egret.callLater(function(){e.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"height",{get:function(){return this.$getHeight()},set:function(t){var i=this;this.$setHeight(t),e._propertyChange[this.hashCode]=!0,egret.callLater(function(){e.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorX",{get:function(){return this._anchorX},set:function(t){var i=this;this._anchorX=t,e._propertyChange[this.hashCode]=!0,e._anchorChange[this.hashCode]=!0,egret.callLater(function(){e.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorY",{get:function(){return this._anchorY},set:function(t){var i=this;this._anchorY=t,e._propertyChange[this.hashCode]=!0,e._anchorChange[this.hashCode]=!0,egret.callLater(function(){e.changeAnchor(i)},this)},enumerable:!0,configurable:!0})},e.changeAnchor=function(e){this._propertyChange[e.hashCode]&&this._anchorChange[e.hashCode]&&(e.anchorOffsetX=e._anchorX*e.width,e.anchorOffsetY=e._anchorY*e.height,delete this._propertyChange[e.hashCode])},e}();egret.registerClass(AnchorUtils,"AnchorUtils");var ArrayUtils=function(){function e(){}var t=(__define,e);t.prototype;return e.forEach=function(e,t,i){for(var n=0,r=e.length;r>n;n++)t.apply(i,[e[n]])},e.remove=function(e,t){var i=e.indexOf(t);e.splice(i,1)},e}();egret.registerClass(ArrayUtils,"ArrayUtils");var DateUtils=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getFormatBySecond=function(e,t){void 0===t&&(t=1);var i="";switch(t){case 1:i=this.getFormatBySecond1(e);break;case 2:i=this.getFormatBySecond2(e);break;case 3:i=this.getFormatBySecond3(e);break;case 4:i=this.getFormatBySecond4(e);break;case 5:i=this.getFormatBySecond5(e)}return i},i.getFormatBySecond1=function(e){void 0===e&&(e=0);var t,i=Math.floor(e/3600);t=0==i?"00":10>i?"0"+i:""+i;var n,r,s=Math.floor((e-3600*i)/60),o=Math.floor((e-3600*i)%60);return n=0==s?"00":10>s?"0"+s:""+s,r=0==o?"00":10>o?"0"+o:""+o,t+":"+n+":"+r},i.getFormatBySecond3=function(e){void 0===e&&(e=0);var t,i,n=Math.floor(e/3600),r=Math.floor((e-3600*n)/60),s=Math.floor((e-3600*n)%60);return t=0==r?"00":10>r?"0"+r:""+r,i=0==s?"00":10>s?"0"+s:""+s,t+":"+i},i.getFormatBySecond2=function(e){var t=new Date(e),i=t.getFullYear(),n=t.getMonth()+1,r=t.getDate(),s=t.getHours(),o=t.getMinutes(),a=t.getSeconds();return i+"-"+n+"-"+r+" "+s+":"+o+":"+a},i.getFormatBySecond4=function(e){var t=Math.floor(e/3600);return t>0?t>24?Math.floor(t/24)+"天前":t+"小时前":Math.floor(e/60)+"分钟前"},i.getFormatBySecond5=function(e){var t=86400,i=3600,n=60,r=Math.floor(e/t),s=Math.floor(e%t/i),o=Math.floor((e-s*i)/n),a=Math.floor((e-s*i)%n),h="",l="",c="",u="";return e>0?0==r?(h="",0==s?(l="",0==o?(c="",u=0==a?"":10>a?"0"+a+"秒":""+a+"秒"):(c=""+o+"分",u=0==a?"":10>a?"0"+a+"秒":""+a+"秒",c+u)):(l=s+"小时",0==o?(c="",u=0==a?"":10>a?"0"+a+"秒":""+a+"秒"):(c=10>o?"0"+o+"分":""+o+"分",l+c))):(h=r+"天",l=0==s?"":10>s?"0"+s+"小时":""+s+"小时",h+l):""},e}();egret.registerClass(DateUtils,"DateUtils");var DebugUtils=function(){function e(){}var t=__define,i=e;i.prototype;return e.isOpen=function(e){this._isOpen=e},t(e,"isDebug",function(){return this._isOpen}),e.start=function(e){this._isOpen&&(this._startTimes[e]=egret.getTimer())},e.stop=function(e){if(!this._isOpen)return 0;if(!this._startTimes[e])return 0;var t=egret.getTimer()-this._startTimes[e];return t>this._threshold&&this.log(e+": "+t),t},e.setThreshold=function(e){this._threshold=e},e.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this._isOpen&&(e[0]="[DebugLog]"+e[0],console.log.apply(console,e))},e._isOpen=!1,e._startTimes={},e._threshold=3,e}();egret.registerClass(DebugUtils,"DebugUtils");var DeviceUtils=function(){function e(){}var t=__define,i=e;i.prototype;return t(e,"IsHtml5",function(){return egret.Capabilities.runtimeType==egret.RuntimeType.WEB}),t(e,"IsNative",function(){return egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE}),t(e,"IsMobile",function(){return egret.Capabilities.isMobile}),t(e,"IsPC",function(){return!egret.Capabilities.isMobile}),t(e,"IsQQBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MQQBrowser")}),t(e,"IsIEBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MSIE")}),t(e,"IsFirefoxBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Firefox")}),t(e,"IsChromeBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Chrome")}),t(e,"IsSafariBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Safari")}),t(e,"IsOperaBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Opera")}),e}();egret.registerClass(DeviceUtils,"DeviceUtils");var DisplayUtils=function(){function e(){}var t=(__define,e);t.prototype;return e.createBitmap=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},e.removeFromParent=function(e){null!=e.parent&&e.parent.removeChild(e)},e}();egret.registerClass(DisplayUtils,"DisplayUtils");var DrawUtils=function(){function e(){}var t=(__define,e);t.prototype;return e.drawRoundHexagon=function(e,t,i,n){var r=e.graphics;r.clear(),r.lineStyle(i,n),r.beginFill(n),t-=Math.ceil(i/2),r.moveTo(-t/2,-t*Math.sqrt(3)/2),r.lineTo(t/2,-t*Math.sqrt(3)/2),r.lineTo(t,0),r.lineTo(t/2,t*Math.sqrt(3)/2),r.lineTo(-t/2,t*Math.sqrt(3)/2),r.lineTo(-t,0),r.lineTo(-t/2,-t*Math.sqrt(3)/2),r.endFill()},e.drawRect=function(e,t,i,n){var r=e.graphics;r.clear(),r.beginFill(n),r.drawRect(0,0,t,i),r.endFill()},e.drawRoundRect=function(e,t,i,n,r,s){var o=e.graphics;o.clear(),o.beginFill(s),o.drawRoundRect(0,0,t,i,n,r),o.endFill()},e.drawHollowRect=function(e,t,i,n,r){var s=e.graphics;s.clear(),s.lineStyle(n,r),s.moveTo(n/2,n/2),s.lineTo(t+n/2,n/2),s.lineTo(t+n/2,i+n/2),s.lineTo(n/2,i+n/2),s.lineTo(n/2,n/2)},e.drawTriangle=function(e,t,i,n){var r=e.graphics;r.clear(),r.lineStyle(i,n);var s=function(e){return t*Math.cos((60*e+30)/180*Math.PI)},o=function(e){return t*Math.sin((60*e+30)/180*Math.PI)};r.moveTo(s(0),o(0)),r.lineTo(s(2),o(2)),r.lineTo(s(4),o(4)),r.lineTo(s(0),o(0))},e.drawStar=function(e,t,i,n){var r=e.graphics;r.clear(),r.lineStyle(i,n);var s=function(e){return t*Math.cos((72*e-18)/180*Math.PI)},o=function(e){return t*Math.sin((72*e-18)/180*Math.PI)};r.moveTo(s(0),o(0)),r.lineTo(s(2),o(2)),r.lineTo(s(4),o(4)),r.lineTo(s(1),o(1)),r.lineTo(s(3),o(3)),r.lineTo(s(0),o(0))},e.drawCross=function(e,t,i,n){var r=e.graphics;r.clear(),r.lineStyle(i,n),r.moveTo(-t/2,0),r.lineTo(t/2,0),r.moveTo(0,-t/2),r.lineTo(0,t/2)},e.drawMi=function(e,t,i,n){var r=e.graphics;r.clear(),r.lineStyle(i,n),r.moveTo(-t/2,0),r.lineTo(t/2,0),r.moveTo(0,-t/2),r.lineTo(0,t/2);var s=Math.sin(Math.PI/4);r.moveTo(t/2*-s,t/2*-s),r.lineTo(t/2*s,t/2*s),r.moveTo(t/2*-s,t/2*s),r.lineTo(t/2*s,t/2*-s)},e.drawCircle=function(e,t,i){var n=e.graphics;n.clear(),n.beginFill(i),n.drawCircle(0,0,t),n.endFill()},e.drawLine=function(e,t,i,n,r){var s=e.graphics;s.clear(),s.lineStyle(n,r),s.moveTo(t.x,t.y),s.lineTo(i.x,i.y),e.graphics.endFill()},e}();egret.registerClass(DrawUtils,"DrawUtils");var Utils=function(){function e(){}var t=(__define,e);t.prototype;return e.macIconShake=function(e,t){for(var i=[[20,300],[15,300],[10,300],[5,300]],n="egret.Tween.get("+e+")",r=0,s=i.length;s>r;r++)n+=".to({'y':"+t+"-"+i[r][0]+"}, "+i[r][1]+")",n+=".to({'y':"+t+"}, "+i[r][1]+")";return n+=";"},e.startFlicker=function(e,t){e.alpha=1,egret.Tween.get(e).to({alpha:0},t).to({alpha:1},t).call(this.startFlicker,this,[e])},e.stopFlicker=function(e){egret.Tween.removeTweens(e)},e}();egret.registerClass(Utils,"Utils");var FrameExecutor=function(){function e(e){this.delayFrame=e,this.frameDelay=new FrameDelay,this.functions=new Array}var t=(__define,e),i=t.prototype;return i.regist=function(e,t){this.functions.push([e,t])},i.execute=function(){if(this.functions.length){var e=this.functions.shift();e[0].call(e[1]),this.frameDelay.delayCall(this.delayFrame,this.execute,this)}},e}();egret.registerClass(FrameExecutor,"FrameExecutor");var FrameDelay=function(){function e(){}var t=(__define,e),i=t.prototype;return i.delayCall=function(e,t,i){this.func=t,this.thisObj=i,TimerManager.doFrame(e,1,this.listener_enterFrame,this)},i.listener_enterFrame=function(){this.func.call(this.thisObj)},e}();egret.registerClass(FrameDelay,"FrameDelay");var KeyboardUtils=function(){function e(){}var t=(__define,e);t.prototype;return e.init=function(){if(this.key_ups=new Array,this.key_downs=new Array,DeviceUtils.IsHtml5){var e=this;document.addEventListener("keyup",function(t){for(var i=0,n=e.key_ups.length;n>i;i++){var r=e.key_ups[i][0],s=e.key_ups[i][1];s?r.call(s,t.keyCode):r(t.keyCode)}}),document.addEventListener("keydown",function(t){for(var i=0,n=e.key_downs.length;n>i;i++){var r=e.key_downs[i][0],s=e.key_downs[i][1];s?r.call(s,t.keyCode):r(t.keyCode)}})}},e.addKeyUp=function(e,t){this.key_ups.push([e,t])},e.addKeyDown=function(e,t){this.key_downs.push([e,t])},e.removeKeyUp=function(e,t){for(var i=0;i<this.key_ups.length;i++)this.key_ups[i][0]==e&&this.key_ups[i][1]==t&&(this.key_ups.splice(i,1),i--)},e.removeKeyDown=function(e,t){for(var i=0;i<this.key_downs.length;i++)this.key_downs[i][0]==e&&this.key_downs[i][1]==t&&(this.key_downs.splice(i,1),i--)},e}();egret.registerClass(KeyboardUtils,"KeyboardUtils");var Keyboard=function(){function e(){}var t=(__define,e);t.prototype;return e.LEFT=37,e.RIGHT=39,e.UP=38,e.DOWN=40,e.W=87,e.A=65,e.S=83,e.D=68,e.J=74,e.K=75,e.L=76,e.U=85,e.I=73,e.O=79,e.P=80,e.SPACE=32,e}();egret.registerClass(Keyboard,"Keyboard");var Log=function(){function e(){}var t=(__define,e);t.prototype;return e.trace=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];DebugUtils.isDebug&&(e[0]="[DebugLog]"+e[0],console.log.apply(console,e))},e}();egret.registerClass(Log,"Log");var MathUtils=function(){function e(){}var t=(__define,e);
t.prototype;return e.getAngle=function(e){return 180*e/Math.PI},e.getRadian=function(e){return Math.PI=e/180*Math.PI},e.getRadian2=function(e,t,i,n){var r=i-e,s=n-t;return Math.atan2(s,r)},e.getDistance=function(e,t,i,n){var r=i-e,s=n-t,o=r*r+s*s;return Math.sqrt(o)},e.log=function(e,t){for(var i=0;(t=Math.floor(t/e))>0;)i+=1;return i},e}();egret.registerClass(MathUtils,"MathUtils");var MazeUtils=function(){function e(){}var t=(__define,e);t.prototype;return e.findPath=function(e,t,i){for(this._openList=[],this._closeList=[],this._mazeList=e,this._openList.push(t);this._openList.length>0;){this._openList.sort(this.sortF);var n=this._openList.shift();this._closeList.push(n);for(var r=this.getAroundPoint(n),s=0;s<r.length;s++){var o=r[s];this.getInOpenList(o)?this.recalcPoint(n,o):this.addPoint(n,i,o)}if(this.getInOpenList(i))return this.getInOpenList(i)}return this.getInOpenList(i)?this.getInOpenList(i):void 0},e.sortF=function(e,t){return e.F-t.F},e.getInOpenList=function(e){for(var t=this._openList,i=0;i<t.length;i++){var n=t[i];if(n.X==e.X&&n.Y==e.Y)return n}},e.getInCloseList=function(e){for(var t=this._closeList,i=0;i<t.length;i++){var n=t[i];if(n.X==e.X&&n.Y==e.Y)return n}},e.getAroundPoint=function(e){for(var t=[],i=-1;1>=i;i++)for(var n=-1;1>=n;n++)if(0!=i||0!=n){var r=!1;if(e.X%2==0?(0==i||n>=0)&&(r=!0):(0==i||0>=n)&&(r=!0),r){var s=new Point(e.X+i,e.Y+n);this.canReach(s)&&t.push(s)}}return t},e.addPoint=function(e,t,i){i.parent=e,i.G=this.calcG(e,i),i.H=this.calcH(t,i),this._openList.push(i)},e.recalcPoint=function(e,t){var i=this.calcG(e,t);i<t.G&&(t.parent=e,t.G=i)},e.calcG=function(e,t){var i=t.parent?t.parent.G:0;return i+1},e.calcH=function(e,t){return Math.abs(e.X-t.X)+Math.abs(e.Y-t.Y)},e.canReach=function(e){var t=e.X,i=e.Y,n=this._mazeList;return!this.getInCloseList(e)&&t>=0&&n.length>t&&i>=0&&n[t].length>i&&0==n[t][i]},e}();egret.registerClass(MazeUtils,"MazeUtils");var Point=function(){function e(e,t){this.G=0,this.H=0,this.X=e,this.Y=t}var t=__define,i=e,n=i.prototype;return t(n,"F",function(){return this.G+this.H}),e}();egret.registerClass(Point,"Point");var ObjectPool=function(){function e(){}var t=(__define,e);t.prototype;return e.pop=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];e._content[t]||(e._content[t]=[]);var r=e._content[t];if(r.length)return r.pop();var s,o=egret.getDefinitionByName(t),a=i.length;return 0==a?s=new o:1==a?s=new o(i[0]):2==a?s=new o(i[0],i[1]):3==a?s=new o(i[0],i[1],i[2]):4==a?s=new o(i[0],i[1],i[2],i[3]):5==a&&(s=new o(i[0],i[1],i[2],i[3],i[4])),s.ObjectPoolKey=t,s},e.popWithExtraKey=function(t,i){e._content[t]||(e._content[t]=[]);var n,r=e._content[t];if(r.length)for(var s=0;s<r.length;s++)if(r[s].extraKey==i){n=r[s],r.splice(s,1);break}if(!n){var o=egret.getDefinitionByName(t);n=new o(i),n.extraKey=i,n.ObjectPoolKey=t}return n},e.push=function(t){if(null==t)return!1;var i=t.ObjectPoolKey,n=e._content[i];return!n||n.indexOf(t)>=0?!1:(e._content[i].push(t),!0)},e.clear=function(){e._content={}},e.clearClass=function(t,i){void 0===i&&(i=null);for(var n=e._content[t];n&&n.length;){var r=n.pop();i&&r[i](),r=null}e._content[t]=null,delete e._content[t]},e.dealFunc=function(t,i){var n=e._content[t];if(null!=n){var r=0,s=n.length;for(r;s>r;r++)n[r][i]()}},e._content={},e}();egret.registerClass(ObjectPool,"ObjectPool");var RandomUtils=function(){function e(){}var t=(__define,e);t.prototype;return e.limit=function(e,t){e=Math.min(e,t),t=Math.max(e,t);var i=t-e;return e+Math.random()*i},e.limitInteger=function(e,t){return Math.round(this.limit(e,t))},e.randomArray=function(e){var t=Math.floor(Math.random()*e.length);return e[t]},e}();egret.registerClass(RandomUtils,"RandomUtils");var Rocker=function(){function e(){}var t=(__define,e),i=t.prototype;return i.init=function(e,t,i,n){this.keys=[0,0],this.mouseX=-1,this.mouseY=-1,this.moveFlag=t,this.moveFlagX=t.x,this.moveFlagY=t.y,this.moveFlagGoX=this.moveFlagX,this.moveFlagGoY=this.moveFlagY,this.moveFlagWidthHelf=.5*e.width,this.moveFlagRec=new egret.Rectangle(this.moveFlagX-.5*e.width,this.moveFlagY-.5*e.height,e.width,e.height),this.moveFlagCheckRec=new egret.Rectangle(0,0,.5*StageUtils.stageW,StageUtils.stageH),this.dealKeyFunc=i,this.dealKeyTarget=n,this.moveFlag.touchEnabled=!0,this.moveFlag.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.startMove,this),this.moveFlag.addEventListener(egret.TouchEvent.TOUCH_END,this.stopMove,this),this.moveFlag.addEventListener(egret.TouchEvent.TOUCH_TAP,this.stopEvent,this),StageUtils.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.leaveStateEvent,this),StageUtils.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.heroMoveEvent,this),KeyboardUtils.addKeyDown(this.onKeyDown,this),KeyboardUtils.addKeyUp(this.onKeyUp,this)},i.onKeyDown=function(e){switch(e){case Keyboard.A:this.keys[0]=-1,this.startCheckKey();break;case Keyboard.D:this.keys[0]=1,this.startCheckKey();break;case Keyboard.W:this.keys[1]=-1,this.startCheckKey();break;case Keyboard.S:this.keys[1]=1,this.startCheckKey()}},i.onKeyUp=function(e){switch(e){case Keyboard.A:-1==this.keys[0]&&(this.keys[0]=0);break;case Keyboard.D:1==this.keys[0]&&(this.keys[0]=0);break;case Keyboard.W:-1==this.keys[1]&&(this.keys[1]=0);break;case Keyboard.S:1==this.keys[1]&&(this.keys[1]=0)}},i.stopEvent=function(e){e.stopPropagation()},i.leaveStateEvent=function(e){e.stageX==this.mouseX&&e.stageY==this.mouseY&&this.stopMove()},i.startMove=function(e){this.isMoveing=!0,this.moveFlagGoX=this.moveFlagX,this.moveFlagGoY=this.moveFlagY,this.mouseX=e.stageX,this.mouseY=e.stageY},i.stopMove=function(){this.isMoveing=!1,this.keys[0]=0,this.keys[1]=0,this.moveFlagGoX=this.moveFlagX,this.moveFlagGoY=this.moveFlagY,this.mouseX=-1,this.mouseY=-1},i.resetRockerPos=function(){this.moveFlag.x=this.moveFlagX,this.moveFlag.y=this.moveFlagY},i.heroMoveEvent=function(e){this.runMove(e.stageX,e.stageY)},i.runMove=function(e,t){if(this.isMoveing&&(this.moveFlagCheckRec.contains(e,t)||!(Math.abs(this.mouseX-e)>50||Math.abs(this.mouseY-t)>50))){if(this.mouseX=e,this.mouseY=t,this.moveFlagRec.contains(this.mouseX,this.mouseY))this.moveFlagGoX=this.mouseX,this.moveFlagGoY=this.mouseY;else{var i=MathUtils.getRadian2(this.moveFlagX,this.moveFlagY,this.mouseX,this.mouseY);this.moveFlagGoX=this.moveFlagX+Math.cos(i)*this.moveFlagWidthHelf,this.moveFlagGoY=this.moveFlagY+Math.sin(i)*this.moveFlagWidthHelf}this.moveFlagGoX>this.moveFlagX&&Math.abs(this.moveFlagGoX-this.moveFlagX)>10?this.keys[0]=1:this.moveFlagGoX<this.moveFlagX&&Math.abs(this.moveFlagGoX-this.moveFlagX)>10?this.keys[0]=-1:this.keys[0]=0,this.moveFlagGoY>this.moveFlagY&&Math.abs(this.moveFlagGoY-this.moveFlagY)>10?this.keys[1]=1:this.moveFlagGoY<this.moveFlagY&&Math.abs(this.moveFlagGoY-this.moveFlagY)>10?this.keys[1]=-1:this.keys[1]=0,this.startCheckKey()}},i.startCheckKey=function(){this.checkKeying||(this.checkKeying=!0,TimerManager.doFrame(1,0,this.delKeys,this))},i.stopCheckKey=function(){this.keys[0]=0,this.keys[1]=0,this.checkKeying&&(TimerManager.remove(this.delKeys,this),this.checkKeying=!1)},i.delKeys=function(){-1==this.mouseX||this.moveFlagCheckRec.contains(this.mouseX,this.mouseY)||this.stopMove(),this.moveFlag.x!=this.moveFlagGoX&&(this.moveFlag.x=this.moveFlagGoX),this.moveFlag.y!=this.moveFlagGoY&&(this.moveFlag.y=this.moveFlagGoY),this.keys[0]||this.keys[1]||this.stopCheckKey(),this.dealKeyFunc.call(this.dealKeyTarget,this.keys[0],this.keys[1])||this.resetRockerPos()},i.stop=function(){this.stopCheckKey(),this.stopMove()},e}();egret.registerClass(Rocker,"Rocker");var ShockUtils=function(){function e(){}var t=__define,i=e;i.prototype;return e.destroy=function(){this.stop()},e.shock=function(e,t,i){void 0===e&&(e=0),void 0===t&&(t=null),void 0===i&&(i=3),this._target||(this._type=e,this._target=t,this._type==this.MAP?(this._shockPoss=this.mapPoss.concat(),this._shockLength=this._shockPoss.length):this._type==this.SPRITE&&(this._shockPoss=this.spritePoss.concat(),this._shockLength=this._shockPoss.length),this.start(i))},e.start=function(e){void 0===e&&(e=1),this.repeatCount=e,this._shockCount=0,this._target&&(this._type!=this.MAP&&(this._rx=this._target.x),this._ry=this._target.y,TimerManager.doFrame(1,0,this.onShockEnter,this))},e.stop=function(){this._target&&(this._type!=this.MAP&&(this._target.x=this._rx),this._target.y=this._ry,TimerManager.remove(this.onShockEnter,this)),this._target=null},e.onShockEnter=function(e){var t=this._shockLength*this._repeatCount;if(this._shockCount>=t)return void this.stop();var i=this._shockCount%this._shockLength,n=this._shockPoss[i];this._target&&(this._type!=this.MAP&&(this._target.x=this._rx+n.x),this._target.y=this._ry+n.y),this._shockCount++},t(e,"repeatCount",function(){return this._repeatCount},function(e){this._repeatCount=e}),e.MAP=0,e.SPRITE=1,e.mapPoss=[new egret.Point(0,3),new egret.Point(0,0),new egret.Point(0,-2)],e.spritePoss=[new egret.Point(5,0),new egret.Point(-5,0),new egret.Point(5,0)],e._shockLength=0,e._shockCount=0,e._rx=0,e._ry=0,e._type=0,e._repeatCount=0,e}();egret.registerClass(ShockUtils,"ShockUtils");var SortUtils=function(){function e(){}var t=(__define,e);t.prototype;return e.sortNum=function(e,t){return e-t},e.random=function(e,t){return Math.random()-.5},e}();egret.registerClass(SortUtils,"SortUtils");var StageUtils=function(){function e(){}var t=__define,i=e;i.prototype;return t(e,"stage",function(){return egret.MainContext.instance.stage}),t(e,"stageW",function(){return egret.MainContext.instance.stage.stageWidth}),t(e,"stageH",function(){return egret.MainContext.instance.stage.stageHeight}),e}();egret.registerClass(StageUtils,"StageUtils");var StringUtils=function(){function e(){}var t=(__define,e);t.prototype;return e.trimSpace=function(e){return e.replace(/^\s*(.*?)[\s\n]*$/g,"$1")},e.getStringLength=function(e){for(var t=e.split(""),i=0,n=0;n<t.length;n++){var r=t[n];i+=this.isChinese(r)?2:1}return i},e.isChinese=function(e){var t=/^.*[\u4E00-\u9FA5]+.*$/;return t.test(e)},e}();egret.registerClass(StringUtils,"StringUtils");var TextFlowMaker=function(){function e(){}var t=(__define,e);t.prototype;return e.generateTextFlow=function(e){for(var t=e.split("|"),i=[],n=0,r=t.length;r>n;n++)i.push(this.getSingleTextFlow(t[n]));return i},e.getSingleTextFlow=function(e){for(var t,i=e.split("&"),n={style:{}},r=0,s=i.length;s>r;r++)t=i[r].split(":"),t[0]==this.PROP_TEXT?n.text=t[1]:t[0]==this.STYLE_SIZE?n.style.size=parseInt(t[1]):t[0]==this.STYLE_COLOR?n.style.textColor=parseInt(t[1]):n.text=t[0];return n},e.STYLE_COLOR="C",e.STYLE_SIZE="S",e.PROP_TEXT="T",e}();egret.registerClass(TextFlowMaker,"TextFlowMaker");var TimerManager=function(){function e(){}var t=__define,i=e;i.prototype;return e.init=function(){this._handlers=new Array,this._delHandlers=new Array,this._currTime=egret.getTimer(),this._currFrame=0,this._count=0,this._timeScale=1,egret.Ticker.getInstance().register(this.onEnterFrame,this)},e.setTimeScale=function(e){this._timeScale=e},e.onEnterFrame=function(){this._currFrame++,this._currTime=egret.getTimer(),DebugUtils.start("TimerManager:");for(var e=0;e<this._count;e++){var t=this._handlers[e],i=t.userFrame?this._currFrame:this._currTime;i>=t.exeTime&&(DebugUtils.start(t.method.toString()),t.method.call(t.methodObj,(this._currTime-t.dealTime)*this._timeScale),DebugUtils.stop(t.method.toString()),t.dealTime=this._currTime,t.exeTime+=t.delay,t.repeat||(t.repeatCount>1?t.repeatCount--:(t.complateMethod&&t.complateMethod.apply(t.complateMethodObj),this._delHandlers.push(t))))}for(;this._delHandlers.length;){var t=this._delHandlers.pop();this.remove(t.method,t.methodObj)}DebugUtils.stop("TimerManager:")},e.create=function(e,t,i,n,r,s,o){if(!(0>t||0>i||null==n)){this.remove(n,r);var a=ObjectPool.pop("TimerHandler");a.userFrame=e,a.repeat=0==i,a.repeatCount=i,a.delay=t,a.method=n,a.methodObj=r,a.complateMethod=s,a.complateMethodObj=o,a.exeTime=t+(e?this._currFrame:this._currTime),a.dealTime=this._currTime,this._handlers.push(a),this._count++}},e.doTimer=function(e,t,i,n,r,s){void 0===r&&(r=null),void 0===s&&(s=null),this.create(!1,e,t,i,n,r,s)},e.doFrame=function(e,t,i,n,r,s){void 0===r&&(r=null),void 0===s&&(s=null),this.create(!0,e,t,i,n,r,s)},t(e,"count",function(){return this._count}),e.remove=function(e,t){for(var i=0;i<this._count;i++){var n=this._handlers[i];if(n.method==e&&n.methodObj==t){this._handlers.splice(i,1),ObjectPool.push(n),this._count--;break}}},e.removeAll=function(e){for(var t=0;t<this._count;t++){var i=this._handlers[t];i.methodObj==e&&(this._handlers.splice(t,1),ObjectPool.push(i),this._count--,t--)}},e.isExists=function(e,t){for(var i=0;i<this._count;i++){var n=this._handlers[i];if(n.method==e&&n.methodObj==t)return!0}return!1},e}();egret.registerClass(TimerManager,"TimerManager");var TimerHandler=function(){function e(){this.delay=0,this.repeatCount=0,this.exeTime=0,this.dealTime=0}var t=(__define,e),i=t.prototype;return i.clear=function(){this.method=null,this.methodObj=null,this.complateMethod=null,this.complateMethodObj=null},e}();egret.registerClass(TimerHandler,"TimerHandler");