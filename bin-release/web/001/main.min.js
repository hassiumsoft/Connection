var EgretExpandManager=function(){function t(){}var e=(__define,t);e.prototype;return t.init=function(){AnchorUtils.init(),TimerManager.init(),TweenManager.init(),KeyboardUtils.init()},t}();egret.registerClass(EgretExpandManager,"EgretExpandManager");var Arrow=function(t){function e(){t.call(this),this.addChild(DisplayUtils.createBitmap("arrow_png")),this.scaleX=this.scaleY=.7,AnchorUtils.setAnchor(this,.5)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.destroy=function(){DisplayUtils.removeFromParent(this),ObjectPool.push(this)},e}(egret.DisplayObjectContainer);egret.registerClass(Arrow,"Arrow");var Chests=function(t){function e(){t.call(this),this.addChild(this._bg=DisplayUtils.createBitmap("chest_bg_png")),this.width=this._bg.width,this.height=this._bg.height,this.addChild(this._hint=DisplayUtils.createBitmap("hint_png")),AnchorUtils.setAnchorX(this._hint,.5),AnchorUtils.setAnchorY(this._hint,1),this._hint.x=this.width/2,this._hint.y=this.height,this.initChests(),this.addChild(this._key=new egret.Bitmap),this._key.visible=!1}__extends(e,t);var i=(__define,e),s=i.prototype;return s.initChests=function(){var t=this.width/6;this._chestArr=[];for(var e=0;5>e;e++){var i=ObjectPool.pop("DoorFx");i.x=t*(e+1),i.y=35,this.addChild(i),this._chestArr.push(i),i.playStatic()}this._unlockCnt=0},s.unlock=function(t,e,i){var s=this,n=this._chestArr[this._unlockCnt];if(n){this.setKey(t,e,i);var r=new Tween(this._key);r.to={y:n.y+10},r.duration=600,r.start();var a=new Tween(this._key);a.to={x:n.x},a.duration=600,a.ease=TweenEase.QuadOut,a.start();var o=new Tween(this._key);o.to={rotation:-440},o.duration=600,o.ease=TweenEase.QuadOut,o.start();var h=new Tween(this._key);h.to={alpha:0},h.duration=100,h.delay=o.duration,h.callBack=function(){s._key.visible=!1,s._unlockCnt+=1,n.playOpen()},h.start()}},s.shake=function(){var t=new Tween(this);t.to={scaleX:1.02,scaleY:1.02},t.duration=80,t.start();var e=new Tween(this);e.to={scaleX:1,scaleY:1},e.duration=80,e.delay=t.duration+30,e.start();for(var i=0;i<this._chestArr.length;i++){var s=this._chestArr[i];i<this._unlockCnt?s.playShakeOpened():s.playShakeClosed()}},s.setKey=function(t,e,i){this._key.texture=RES.getRes("key_"+i+"_png"),this._key.visible=!0,this._key.alpha=1,this._key.x=t,this._key.y=e,AnchorUtils.setAnchor(this._key,.5)},s.destroy=function(){DisplayUtils.removeFromParent(this),ObjectPool.push(this)},e}(egret.DisplayObjectContainer);egret.registerClass(Chests,"Chests");var Countdown=function(t){function e(){t.call(this),this.addChild(this._timeBg=DisplayUtils.createBitmap("time_bg_png")),AnchorUtils.setAnchor(this._timeBg,.5),this.addChild(this._timeProgress=DisplayUtils.createBitmap("time_progress_png")),AnchorUtils.setAnchor(this._timeProgress,.5),this._timeProgress.y=16,this._timeProgress.x=-2,this.addChild(this._timeMask=new egret.Sprite),DrawUtils.drawRect(this._timeMask,this._timeProgress.width,this._timeProgress.height,16777215),AnchorUtils.setAnchor(this._timeMask,.5),this._timeMask.y=this._timeProgress.y,this._timeProgress.mask=this._timeMask,this.addChild(this._progressBg=new egret.Sprite),DrawUtils.drawRect(this._progressBg,.97*this._timeProgress.width,.75*this._timeProgress.height,16777215),AnchorUtils.setAnchor(this._progressBg,.5),this._progressBg.x=this._timeProgress.x,this._progressBg.y=this._timeProgress.y,this.swapChildren(this._progressBg,this._timeProgress),this.addChild(this._bgMask=new egret.Sprite),DrawUtils.drawRect(this._bgMask,this._timeProgress.width,this._timeProgress.height,16777215),AnchorUtils.setAnchor(this._bgMask,.5),this._bgMask.y=this._timeProgress.y,this._progressBg.mask=this._bgMask,this.addChild(this._text=new Label),this._text.width=200,AnchorUtils.setAnchorX(this._text,.5),AnchorUtils.setAnchorY(this._text,.3),this._text.y=this._timeProgress.y+15,this._text.size=32,this._text.stroke=3,this._text.strokeColor=5657213,this.addChild(this._textMask=new Label),this._textMask.width=200,AnchorUtils.setAnchorX(this._textMask,.5),AnchorUtils.setAnchorY(this._textMask,.3),this._textMask.y=this._timeProgress.y+15,this._textMask.size=32,this._textMask.stroke=3,this._textMask.strokeColor=16777215,this._textMask.alpha=0,this.addChild(this._overText=new Label),this._overText.width=200,AnchorUtils.setAnchor(this._overText,.5),this._overText.x=10,this._overText.y=this._timeProgress.y,this._overText.size=26,this._overText.stroke=3,this._overText.text="Game Over",this._overText.visible=!1,TimerManager.doFrame(1,0,this.update,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(t){this._topTime=t,this._curTime=t,this._isInit=!0},s.update=function(t){var e=this._curTime?this._curTime:0,i=this._topTime?this._topTime:1,s=e/i,n=this._per?this._per:0,r=t/5e3;this._isInit&&(r*=10),s=Math.max(0,s),this.setProgressBg(s),n=Math.min(s,n+r,1),this.setProgress(n),this._per=n,this._isInit?this.setText(i*n):this.setText(i*s)},s.setTime=function(t){this._curTime=t,this._isInit=!1},s.over=function(){var t=this,e=new Tween(this._text);e.to={scaleX:.35,scaleY:.35,alpha:0},e.duration=400,e.ease=TweenEase.BackIn,e.callBack=function(){t._text.visible=!1},e.start(),this._overText.visible=!0,this._overText.scaleX=this._overText.scaleY=.35,this._overText.alpha=0;var i=new Tween(this._overText);i.to={scaleX:1,scaleY:1,alpha:1},i.updateFunc=function(){t._overText.alpha>1&&(t._overText.alpha=1)},i.duration=400,i.delay=300,i.ease=TweenEase.BackOut,i.start()},s.setProgress=function(t){this._timeMask.x=-this._timeProgress.width*(1-t)+this._timeProgress.x},s.setProgressBg=function(t){this._bgMask.x=-this._timeProgress.width*(1-t)+this._timeProgress.x},s.setText=function(t){3>=t&&t>0&&parseInt(this._ct)>t&&this.blink(),this._ct=t.toString(),this._text.text=DateUtils.getFormatBySecond(t,3)},s.blink=function(){this._textMask.alpha=1,this._textMask.text=this._text.text,this._text.scaleX=this._text.scaleY=1.5,this._textMask.scaleX=this._textMask.scaleY=1.5;var t=new Tween(this._textMask);t.to={scaleX:1,scaleY:1,alpha:0},t.duration=300,t.start();var t=new Tween(this._text);t.to={scaleX:1,scaleY:1},t.duration=300,t.start()},s.destroy=function(){DisplayUtils.removeFromParent(this),ObjectPool.push(this)},e}(egret.DisplayObjectContainer);egret.registerClass(Countdown,"Countdown");var GameCmd=function(){function t(){}var e=(__define,t);e.prototype;return t.GAME_START="game_start",t.GAME_OVER="game_over",t.SHOW_TIME_START="time_start",t.TIME_INIT="time_init",t.SHOW_UNLOCK="show_unlock",t.SHOW_GO="show_go",t.SHOW_PRAISE="show_praise",t.UPDATE_TIME="update_time",t.UPDATE_SCORE="update_score",t.ADD_SCORE="add_score",t.ADD_TIME="add_time",t.ADD_TIMES="add_times",t.FIRE="fire",t.FIRE_OVER="fire_over",t}();egret.registerClass(GameCmd,"GameCmd");var BaseController=function(){function t(t){this._messages={},this._scene=t}var e=(__define,t),i=e.prototype;return i.registerFunc=function(t,e,i){this._messages[t]=[e,i]},i.applyFunc=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var s=this._messages[t];return s?s[0].apply(s[1],e):(Log.trace("消息"+t+"不存在侦听"),null)},i.applyControllerFunc=function(t,e){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];return ControllerManager.instance.applyFunc.apply(ControllerManager.instance,arguments)},i.setModel=function(t){this._model=t},i.getModel=function(){return this._model},i.getControllerModel=function(t){return ControllerManager.instance.getControllerModel(t)},t}();egret.registerClass(BaseController,"BaseController");var GameController=function(t){function e(e){t.call(this,e),this._model=new GameModel(this),ControllerManager.instance.register(ControllerID.Game,this),this.registerFunc(GameCmd.GAME_START,this.gameStart,this),this.registerFunc(GameCmd.GAME_OVER,this.gameOver,this),this.registerFunc(GameCmd.SHOW_TIME_START,this.showTimeStart,this),this.registerFunc(GameCmd.TIME_INIT,this.initTime,this),this.registerFunc(GameCmd.SHOW_GO,this.showGO,this),this.registerFunc(GameCmd.SHOW_UNLOCK,this.showUnlock,this),this.registerFunc(GameCmd.SHOW_PRAISE,this.showPraise,this),this.registerFunc(GameCmd.UPDATE_TIME,this.updateTime,this),this.registerFunc(GameCmd.UPDATE_SCORE,this.updateScore,this),this.registerFunc(GameCmd.ADD_TIMES,this.addTimes,this),this.registerFunc(GameCmd.FIRE,this.fire,this),this.registerFunc(GameCmd.ADD_SCORE,this.addScore,this),this.registerFunc(GameCmd.ADD_TIME,this.addTime,this)}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.gameStart=function(){this.model.start()},n.gameOver=function(){this.scene.gameOver()},n.showTimeStart=function(){this.scene.showTimeStart()},n.initTime=function(t){this.scene.initTime(t)},n.fire=function(){this.model.fire(),this.scene.showFire()},n.showUnlock=function(){this.scene.showUnlock()},n.showGO=function(){this.scene.showGO()},n.showPraise=function(t){this.scene.showPraise(t)},n.updateTime=function(t){this.scene.updateTime(t)},n.updateScore=function(t,e){void 0===e&&(e=!1),this.scene.updateScore(t,e)},n.addTimes=function(t,e,i){var s=this;this.model.addTimes(t,function(t){e?s.scene.addTimes(t,e,i):s.scene.updateTimes(t)})},n.addScore=function(t,e,i,s){var n=this;this.model.addScore(t,e,function(t){n.scene.showScore(t,i,s)})},n.addTime=function(){this.model.addTime(),this.scene.showAddTime()},i(n,"model",function(){return this._model}),i(n,"scene",function(){return this._scene}),e}(BaseController);egret.registerClass(GameController,"GameController");var GameData=function(){function t(){}var e=__define,i=t;i.prototype;return e(t,"font",function(){return"Cookies"}),e(t,"countdown",function(){return 60}),e(t,"hor",function(){return 7}),e(t,"ver",function(){return 8}),e(t,"tileSize",function(){return 90}),t.cacuScore=function(t){var e=0;return t-=2,t>=1&&8>=t?e=10*t:16>=t?e=100*t:24>=t?e=1e3*t:32>=t?e=1e4*t:40>=t?e=5e4*(t-1)+1e5:48>=t?e=1e5*(t-1)+5e5:54>=t&&(e=5e5*(t-1)+15e5),e},t.cacuEffectScore=function(t,e){var i=0;switch(t){case TileEffect.BOMB:i=20*e;break;case TileEffect.CROSS:i=100*e;break;case TileEffect.KIND:i=1e3*e;break;case TileEffect.RANDOM:i=2e4*e}return i},e(t,"keyScore",function(){return 200}),e(t,"timesScore",function(){return 1e3}),t.getTileColor=function(t){var e=[0,8243709,16012888,16629567,12023257];return e[t]},t}();egret.registerClass(GameData,"GameData");var BaseModel=function(){function t(t){this._controller=t,this._controller.setModel(this),this._handles=[],this._time=0,TimerManager.doFrame(1,0,this.update,this)}var e=(__define,t),i=e.prototype;return i.update=function(t){this._time+=t;for(var e=[],i=0;i<this._handles.length;i++)this._time>this._handles[i].execTime&&(this._handles[i].func(),e.push(this._handles[i]));for(var i=0;i<e.length;i++)ArrayUtils.remove(this._handles,e[i])},i.setTimeout=function(t,e){this._handles.push({execTime:t+this._time,func:e})},i.applyFunc=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return this._controller.applyFunc.apply(this._controller,arguments)},i.applyControllerFunc=function(t,e){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];return this._controller.applyControllerFunc.apply(this._controller,arguments)},t}();egret.registerClass(BaseModel,"BaseModel");var GameModel=function(t){function e(){t.apply(this,arguments),this._countdown=0}__extends(e,t);var i=(__define,e),s=i.prototype;return s.start=function(){var t=this;this._updateTime=!1,this._isFire=!1,this.setTimeout(300,function(){return t.showTimeStart()}),this.setTimeout(1200,function(){t.initTime()}),this.setTimeout(1800,function(){t._countdown=GameData.countdown,t._updateTime=!0,t.showGO()}),this._score=0,this._times=0,this.updateScore()},s.fire=function(){this._isFire=!0,this._fireTime=10},s.fireOver=function(){this._isFire=!1,this.applyControllerFunc(ControllerID.Grid,GameCmd.FIRE_OVER)},s.addScore=function(t,e,i){var s=this;e*=this._times+(this._isFire?10:0),this.setTimeout(t+1200,function(){s._score+=e,s.updateScore(!0)}),this.setTimeout(t,function(){return i(e)})},s.addTime=function(){var t=this;return this.setTimeout(500,function(){t._countdown+=5}),5},s.addTimes=function(t,e){var i=this;this._times+=1,this.setTimeout(t,function(){return e(i._times)})},s.update=function(e){t.prototype.update.call(this,e),this._updateTime&&(this._isFire?(this._fireTime-=e/1e3,this._fireTime<=0&&this.fireOver()):(this._countdown-=e/1e3,this._countdown<=0&&(this.gameOver(),this._updateTime=!1)),this.updateTime())},s.showTimeStart=function(){this.applyFunc(GameCmd.SHOW_TIME_START)},s.initTime=function(){this.applyFunc(GameCmd.TIME_INIT,GameData.countdown)},s.showGO=function(){this.applyFunc(GameCmd.SHOW_GO)},s.updateTime=function(){this.applyFunc(GameCmd.UPDATE_TIME,this._countdown)},s.updateScore=function(t){void 0===t&&(t=!1),this.applyFunc(GameCmd.UPDATE_SCORE,this._score,t)},s.gameOver=function(){this.applyFunc(GameCmd.GAME_OVER),this.applyControllerFunc(ControllerID.Grid,GameCmd.GAME_OVER)},e}(BaseModel);egret.registerClass(GameModel,"GameModel");var BaseScene=function(t){function e(){t.call(this),this._isInit=!1,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),StageUtils.stage.addEventListener(egret.Event.RESIZE,this.onResize,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(t){this._isInit||(this.init(),this._isInit=!0)},s.init=function(){},s.onResize=function(){},s.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e]},s.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e]},s.applyFunc=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return this._controller.applyFunc.apply(this._controller,arguments)},s.applyControllerFunc=function(t,e){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];return this._controller.applyControllerFunc.apply(this._controller,arguments)},s.setVisible=function(t){this.visible=t},e}(egret.DisplayObjectContainer);egret.registerClass(BaseScene,"BaseScene");var GameScene=function(t){function e(){t.call(this),this._controller=new GameController(this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this.addChild(this._grid=new Grid),AnchorUtils.setAnchorX(this._grid,.5),AnchorUtils.setAnchorY(this._grid,1),this.addChild(this._topBg=DisplayUtils.createBitmap("bg_png")),AnchorUtils.setAnchorX(this._topBg,.5),this.addChild(this._scoreBg=DisplayUtils.createBitmap("score_bg_png")),AnchorUtils.setAnchor(this._scoreBg,.5),this.addChild(this._score=new Label),this._score.width=400,this._score.size=45,this._score.stroke=3,AnchorUtils.setAnchorX(this._score,.5),this.addChild(this._timesBg=DisplayUtils.createBitmap("times_bg_png")),AnchorUtils.setAnchor(this._timesBg,.5),this.addChild(this._times=new Label),this._times.width=120,this._times.size=26,this._times.stroke=3,this._times.textColor=0,this._times.strokeColor=16777215,AnchorUtils.setAnchorX(this._times,.5),this.addChild(this._countdown=new Countdown),this.addChild(this._scoreCon=new egret.DisplayObjectContainer),this.addChild(this._timesCon=new egret.DisplayObjectContainer),this.addChild(this._hintCon=new egret.DisplayObjectContainer)},s.onResize=function(){var t=StageUtils.stageW,e=StageUtils.stageH;this._grid.x=t/2,this._grid.y=e,this._topBg.x=t/2,this._topBg.y=0,this._scoreBg.x=t/2,this._scoreBg.y=200,this._score.x=this._scoreBg.x,this._score.y=this._scoreBg.y-35,this._timesBg.x=this._scoreBg.x,this._timesBg.y=this._scoreBg.y+55,this._timesBg.visible=!1,this._times.x=this._timesBg.x,this._times.y=this._timesBg.y-25,this._countdown.x=t/2,this._countdown.y=this._topBg.height-33,this._hintCon.x=t/2,this._hintCon.y=this._grid.y-this._grid.height/2},s.showTimeStart=function(){var t=ObjectPool.pop("Hint");this._hintCon.addChild(t),t.y=-80,t.show1("hint_time_start_png",.5,.35)},s.initTime=function(t){this._countdown.init(t)},s.showGO=function(){var t=ObjectPool.pop("Hint");this._hintCon.addChild(t),t.y=-80,t.show1("hint_go_png",.5,.35)},s.updateTime=function(t){this._countdown.setTime(t)},s.updateScore=function(t,e){void 0===e&&(e=!1),e?this.blinkScore(""+t):this._score.text=""+t},s.blinkScore=function(t){var e=this._score;TweenManager.removeTween(e);var i=16777215,s=0,n=16776901,r=12291229,a=16776569,o=16777215;e.textColor=n,e.strokeColor=r;var h=new Tween(e);h.duration=20,h.callBack=function(){e.text=t},h.start();var l=new Tween(e);l.delay=h.delay+h.duration,l.duration=70,l.callBack=function(){e.textColor=a,e.strokeColor=o},l.start();var c=new Tween(e);c.delay=l.delay+l.duration,c.duration=90,c.callBack=function(){e.textColor=n,e.strokeColor=r},c.start();var u=new Tween(e);u.delay=c.delay+c.duration,u.duration=90,u.callBack=function(){e.textColor=a,e.strokeColor=o},u.start();var d=new Tween(e);d.delay=u.delay+u.duration,d.duration=40,d.callBack=function(){e.textColor=i,e.strokeColor=s},d.start()},s.updateTimes=function(t){this._times.text="x"+t},s.addTimes=function(t,e,i){var s=this,n=this._grid.getAbsPosition(e.x,e.y),r=ObjectPool.pop("Times");r.setTimes(i),this._timesCon.addChild(r),r.x=n.x,r.y=n.y;var a=new Tween(r);a.to={y:this._times.y+5},a.duration=600,a.start();var o=new Tween(r);o.to={x:this._times.x},o.duration=600,o.ease=TweenEase.QuadOut,o.start();var h=new Tween(r);h.to={scaleY:.3},h.duration=600,h.ease=TweenEase.QuadOut,h.callBack=function(){r.scaleY=1,r.destroy(),s.updateTimes(t)},h.start()},s.showFire=function(){var t=ObjectPool.pop("Hint");this._hintCon.addChild(t),t.y=-80,t.show1("hint_fire_png",.5,.35)},s.showScore=function(t,e,i){var s=ObjectPool.pop("FloatScore"),n=this._grid.getAbsPosition(e.x,e.y);s.x=n.x,s.y=n.y,this._scoreCon.addChild(s),s.show(t,i)},s.showAddTime=function(){var t=ObjectPool.pop("Hint");this._hintCon.addChild(t),t.y=-80,t.show1("hint_add_time_png",.5,.35)},s.showUnlock=function(){var t=ObjectPool.pop("Hint");this._hintCon.addChild(t),t.y=-80,t.show2("hint_unlock_png")},s.showTimesUp=function(){var t=ObjectPool.pop("Hint");this._hintCon.addChild(t),t.y=-80,t.show3("hint_times_up_png")},s.gameOver=function(){this._countdown.over(),this.showTimesUp()},s.showPraise=function(t){var e=ObjectPool.pop("Hint");this._hintCon.addChild(e),e.y=-80,e.show1("hint_praise_"+t+"_png",.5,.35)},s.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i-0]=arguments[i];t.prototype.open.call(this),this.onResize(),this.applyFunc(GameCmd.GAME_START),this.applyControllerFunc(ControllerID.Grid,GameCmd.GAME_START)},s.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i-0]=arguments[i];t.prototype.close.call(this)},e}(BaseScene);egret.registerClass(GameScene,"GameScene");var Grid=function(t){function e(){t.call(this),this._controller=new GridController(this),KeyboardUtils.addKeyUp(function(t){t==Keyboard.LEFT&&TimerManager.setTimeScale(1)},this),KeyboardUtils.addKeyDown(function(t){t==Keyboard.LEFT&&TimerManager.setTimeScale(.05)},this),KeyboardUtils.addKeyUp(function(t){t==Keyboard.RIGHT&&TimerManager.setTimeScale(1)},this),KeyboardUtils.addKeyDown(function(t){t==Keyboard.RIGHT&&TimerManager.setTimeScale(5)},this)}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.init=function(){t.prototype.init.call(this),this.addChild(this._bg=DisplayUtils.createBitmap("grid_bg_png")),this.addChild(this._container=new egret.DisplayObjectContainer),this._border1=DisplayUtils.createBitmap("grid_border_1_png"),this._border2=DisplayUtils.createBitmap("grid_border_2_png"),this._bottom=DisplayUtils.createBitmap("grid_bottom_png"),this.width=this._bg.width=this._border1.width+this._border2.width+640,this.height=this._bg.height=this._border1.height,this.addChild(this._border1),this.addChild(this._border2),this.addChild(this._bottom),AnchorUtils.setAnchor(this._border2,1),this._border2.x=this.width,this._border2.y=this.height,AnchorUtils.setAnchorX(this._bottom,.5),AnchorUtils.setAnchorY(this._bottom,1),this._bottom.x=this.width/2,this._bottom.y=this.height,this.addChild(this._chests=ObjectPool.pop("Chests")),AnchorUtils.setAnchorX(this._chests,.5),AnchorUtils.setAnchorY(this._chests,1),this._chests.x=this.width/2,this._chests.y=this.height+this._chests.height+10,this.addChild(this._select=new egret.Bitmap),this._select.visible=!1,this._container.addChild(this._gridCon=new egret.DisplayObjectContainer),this.initGrid(),this._container.addChild(this._fire=new FireFx),this._fire.x=this.width/2,this._fire.y=this.height,this._fire.alpha=.7,this._fire.visible=!1,this._container.addChild(this._arrowCon=new egret.DisplayObjectContainer),this._arrows=[],this._container.addChild(this._tileCon=new egret.DisplayObjectContainer),this._container.addChild(this._fxCon=new egret.DisplayObjectContainer),this._container.addChild(this._hitCon=new egret.DisplayObjectContainer),this._container.addChild(this._bm=new egret.Sprite),this._container.addChild(this._topTileCon=new egret.DisplayObjectContainer),DrawUtils.drawRect(this._bm,this.width,this.height,0),this._bm.touchEnabled=!0,this._bm.visible=!1,this.touchEnabled=!0,this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEnd,this)},n.initGrid=function(){for(var t=0;t<this.hor;t++)for(var e=0;e<this.ver;e++)if((t+e)%2){var i=this.getTruePosition(t,e),s=DisplayUtils.createBitmap("gem_bg_1_png");AnchorUtils.setAnchor(s,.5),s.x=i.x,s.y=i.y,this._gridCon.addChild(s)}},n.showChests=function(){var t=new Tween(this._chests);t.to={y:this.height+16},t.duration=600,t.ease=TweenEase.CusOut,t.start()},n.hideChests=function(){var t=this;this._bm.visible=!0,this._bm.alpha=0;var e=new Tween(this._bm);e.to={alpha:.6},e.duration=200,e.start();var i=new Tween(this._bm);i.to={alpha:0},i.duration=200,i.delay=1e3,i.callBack=function(){t._bm.visible=!1},i.start();var s=new Tween(this._chests);s.to={y:this.height+this._chests.height+10},s.duration=600,s.ease=TweenEase.CusIn,s.start()},n.unlockChest=function(t,e){var i=this.getTruePosition(t.x,t.y);this._chests.unlock(i.x-this._chests.x+this._chests.anchorOffsetX,i.y-this._chests.y+this._chests.anchorOffsetY,e)},n.newRow=function(t){for(var e=0;e<t.length;e++){var i=this.findTile(t[e].pos);i&&this._topTileCon.addChild(i)}},n.showFire=function(){this._fire.visible=!0,this._fire.play()},n.hideFire=function(){this._fire.visible=!1},n.createTile=function(t){var e=this,i=t.pos,s=ObjectPool.pop("Tile");s.reset(),s.pos=i.clone();var n=this.getTruePosition(i.x,i.y);s.x=n.x,s.y=n.y,s.type=t.type,s.effect=t.effect,s.key=t.key,s.time=t.time,s.times=t.times,s.touchEnabled=!0,s.addTo(this._tileCon),s.setOnTouch(function(){e.tileOnTouch(s.pos)})},n.removeTile=function(t,e){var i=this.findTile(t.pos);i&&(i.parent!=this._tileCon&&this._tileCon.addChild(i),t.effect!=TileEffect.NONE?this.addEffect(t.effect,i.x,i.y):this.addRemoveFx(t.removeFx,i.x,i.y),i.remove(e))},n.hitTile=function(t,e,i){var s=this.findTile(t.pos);s&&(this._hitCon.addChild(s),s.hit(i,e))},n.shake=function(){var t=30,e=new Tween(this._gridCon);e.to={y:1},e.duration=t,e.start();var i=new Tween(this._gridCon);i.to={y:0},i.duration=2*t,i.delay=e.duration,i.start();var s=new Tween(this._container);s.to={y:-1},s.duration=t,s.start();var n=new Tween(this._container);n.to={y:3},n.duration=2*t,n.delay=s.duration,n.start();var r=new Tween(this._container);r.to={y:-3},r.duration=2.5*t,r.delay=n.duration+n.delay+t,r.start();var a=new Tween(this._container);a.to={y:0},a.duration=t,a.delay=r.duration+r.delay+2*t,a.start(),this._chests.shake()},n.shakeTile=function(t,e){var i=this.findTile(t.pos),s=this.getTruePosition(e.x,e.y);i&&i.shake(s.x,s.y)},n.signTiles=function(t){for(var e=0;e<this._tileCon.numChildren;e++){for(var i=this._tileCon.getChildAt(e),s=!1,n=0;n<t.length;n++)i.pos.equalTo(t[n].pos)&&(s=!0);i.sign=s}},n.setSelect=function(t,e){if(0>=e)this._select.texture=null,this._select.visible=!1;else{this._select.visible=!0;var i=RES.getRes("select_"+e+"_png"),s=this.getTruePosition(t.x,t.y);if(this._select.x=s.x,this._select.y=s.y,AnchorUtils.setAnchor(this._select,.5),i!=this._select.texture){this._select.texture=i,TweenManager.removeTween(this._select),this._select.rotation=0,this._select.alpha=.5,this._select.scaleX=this._select.scaleY=.4;var n=new Tween(this._select);n.to={scaleX:1+.25*(e-1),scaleY:1+.25*(e-1),alpha:1},n.duration=300,n.ease=TweenEase.CusOut,n.start();var r=new Tween(this._select);r.to={rotation:360},r.duration=2e3,r.delay=n.duration,r.loop=!0,r.start()}}},n.connectTile=function(t,e,i){var s=this.findTile(t.pos),n=this.findTile(e.pos);n&&(n.select(i),s&&this.addArrow(s.x,s.y,n.x,n.y))},n.selectTile=function(t,e){var i=this.findTile(t.pos);i&&i.select(e)},n.unselectTile=function(t){var e=this.findTile(t.pos);e&&(e.unselect(),this.delArrow())},n.moveTile=function(t){var e=t.tileData,i=t.target,s=t.duration,n=this.findTile(e.pos);if(n){var r=this.getTruePosition(i.x,i.y);n.moveTo(r,s,function(){n.pos=i.clone()})}},n.changeTileEffect=function(t){var e=this.findTile(t.pos);e&&(e.effect=t.effect)},n.changeTileType=function(t){var e=this.findTile(t.pos);e&&(e.type=t.type)},n.changeTileTimes=function(t){var e=this.findTile(t.pos);e&&(e.times=t.times)},n.addRemoveFx=function(t,e,i){var s;switch(t){case TileRemoveFx.Smoke:s=ObjectPool.pop("SmokeFx");break;case TileRemoveFx.Bomb:s=ObjectPool.pop("BombFx");break;case TileRemoveFx.Thunder:s=ObjectPool.pop("ThunderFx")}s.x=e,s.y=i,this._fxCon.addChild(s),s.play()},n.addEffect=function(t,e,i){var s;switch(t){case TileEffect.BOMB:s=ObjectPool.pop("BombFx");break;case TileEffect.CROSS:s=ObjectPool.pop("WaterFx");break;case TileEffect.KIND:s=ObjectPool.pop("ThunderFx");break;case TileEffect.RANDOM:s=ObjectPool.pop("StormFx");var n=this.getTruePosition(0,this.hor);e=n.x,i=n.y+60}s&&(s.x=e,s.y=i,this._fxCon.addChild(s),s.play())},n.addArrow=function(t,e,i,s){var n=ObjectPool.pop("Arrow");n.x=(t+i)/2,n.y=(e+s)/2,n.rotation=MathUtils.getAngle(MathUtils.getRadian2(t,e,i,s)),this._arrowCon.addChild(n),this._arrows.push(n)},n.delArrow=function(){this._arrows.length&&this._arrows.pop().destroy()},n.tileOnTouch=function(t){this.applyFunc(GridCmd.TOUCH_TILE,t)},n.onEnd=function(t){this.applyFunc(GridCmd.TOUCH_END)},n.findTile=function(t){for(var e=0;e<this._tileCon.numChildren;e++){var i=this._tileCon.getChildAt(e);if(i.pos.equalTo(t))return i}for(var e=0;e<this._topTileCon.numChildren;e++){var i=this._topTileCon.getChildAt(e);if(i.pos.equalTo(t))return i}},n.getTruePosition=function(t,e){var t=this.width/2+this.tileSize*(t-this.hor/2+.5),e=this.tileSize*(e+.5)*1.02+this.top;return new Vector2(t,e)},n.getAbsPosition=function(t,e){var i=this.getTruePosition(t,e);return i.x+=this.x-this.anchorOffsetX,i.y+=this.y-this.anchorOffsetY,i},i(n,"hor",function(){return GameData.hor}),i(n,"ver",function(){return GameData.ver}),i(n,"tileSize",function(){return GameData.tileSize}),i(n,"top",function(){return 32}),e}(BaseScene);egret.registerClass(Grid,"Grid");var GridCmd=function(){function t(){}var e=(__define,t);e.prototype;return t.TOUCH_TILE="touch_tile",t.TOUCH_END="touch_end",t.TILE_CREATE="tile_create",t.TILE_REMOVE="tile_remove",t.TILE_HIT="tile_hit",t.TILE_SHAKE="tile_shake",t.TILE_SIGN="tile_sign",t.TILE_CONNECT="tile_connect",t.TILE_SELECT="tile_select",t.TILE_UNSELECT="tile_unselect",t.TILE_MOVE="tile_move",t.TILE_CHANGE_EFFECT="tile_change_effect",t.TILE_CHANGE_TYPE="tile_change_type",t.TILE_CHANGE_TIMES="tile_change_times",t.NEW_ROW="new_row",t.SET_SELECT="set_select",t.SHAKE="shake",t.SHOW_CHESTS="show_chests",t.HIDE_CHESTS="hide_chests",t.UNLOCK_CHEST="unlock_chest",t}();egret.registerClass(GridCmd,"GridCmd");var GridController=function(t){function e(e){t.call(this,e),this._model=new GridModel(this),ControllerManager.instance.register(ControllerID.Grid,this),this.registerFunc(GameCmd.GAME_START,this.start,this),this.registerFunc(GameCmd.GAME_OVER,this.over,this),this.registerFunc(GridCmd.TOUCH_TILE,this.touchTile,this),this.registerFunc(GridCmd.TOUCH_END,this.touchEnd,this),this.registerFunc(GridCmd.TILE_CREATE,this.createTile,this),this.registerFunc(GridCmd.TILE_REMOVE,this.removeTile,this),this.registerFunc(GridCmd.TILE_HIT,this.hitTile,this),this.registerFunc(GridCmd.TILE_SHAKE,this.shakeTile,this),this.registerFunc(GridCmd.TILE_SIGN,this.signTiles,this),this.registerFunc(GridCmd.TILE_CONNECT,this.connectTile,this),this.registerFunc(GridCmd.TILE_SELECT,this.selectTile,this),this.registerFunc(GridCmd.TILE_UNSELECT,this.unselectTile,this),this.registerFunc(GridCmd.TILE_MOVE,this.moveTile,this),this.registerFunc(GridCmd.TILE_CHANGE_EFFECT,this.changeTileEffect,this),this.registerFunc(GridCmd.TILE_CHANGE_TYPE,this.changeTileType,this),this.registerFunc(GridCmd.TILE_CHANGE_TIMES,this.changeTileTimes,this),this.registerFunc(GridCmd.NEW_ROW,this.newRow,this),this.registerFunc(GameCmd.FIRE,this.fire,this),this.registerFunc(GameCmd.FIRE_OVER,this.fireOver,this),this.registerFunc(GridCmd.SET_SELECT,this.setSelect,this),this.registerFunc(GridCmd.SHAKE,this.shake,this),this.registerFunc(GridCmd.SHOW_CHESTS,this.showChests,this),this.registerFunc(GridCmd.HIDE_CHESTS,this.hideChests,this),this.registerFunc(GridCmd.UNLOCK_CHEST,this.unlockChest,this)}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.start=function(){this.model.start()},n.over=function(){this.model.over()},n.touchTile=function(t){this.model.touchTile(t)},n.touchEnd=function(){this.model.touchEnd()},n.newRow=function(t){this.scene.newRow(t)},n.fire=function(){this.scene.showFire()},n.fireOver=function(){this.model.fireOver(),this.scene.hideFire()},n.createTile=function(t){this.scene.createTile(t)},n.removeTile=function(t,e){this.scene.removeTile(t,e)},n.hitTile=function(t,e,i){this.scene.hitTile(t,e,i)},n.showChests=function(){this.scene.showChests()},n.hideChests=function(){this.scene.hideChests()},n.unlockChest=function(t,e){this.scene.unlockChest(t,e)},n.shake=function(){this.scene.shake()},n.shakeTile=function(t,e){this.scene.shakeTile(t,e)},n.signTiles=function(t){this.scene.signTiles(t)},n.setSelect=function(t,e){this.scene.setSelect(t,e)},n.connectTile=function(t,e,i){this.scene.connectTile(t,e,i)},n.selectTile=function(t,e){this.scene.selectTile(t,e)},n.unselectTile=function(t){this.scene.unselectTile(t)},n.moveTile=function(t){this.scene.moveTile(t)},n.changeTileEffect=function(t){this.scene.changeTileEffect(t)},n.changeTileType=function(t){this.scene.changeTileType(t)},n.changeTileTimes=function(t){this.scene.changeTileTimes(t)},i(n,"model",function(){return this._model}),i(n,"scene",function(){return this._scene}),e}(BaseController);egret.registerClass(GridController,"GridController");var GridModel=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.start=function(){this.setState(GridState.Start),this._hor=GameData.hor,this._ver=GameData.ver,this._times=0,this._isFire=!1,this.addTimes(0),this._selectArr=[],this._lastAdd=-1,this._connectArr=[],this._removeArr=[],this.showChests(),this.initTileList(),this.repair(),this._newKey=!0},n.over=function(){this.touchEnd(),this.setState(GridState.Over)},n.touchTile=function(t){var e=this.getTile(t.x,t.y),i=this._selectArr.length;if(this.isState(GridState.Idle))this._selectArr=[e],this.select(e,!1),this.setState(GridState.Select);else if(this.isState(GridState.Select)&&i&&(0==this.curSelectType||0==e.type||this.curSelectType==e.type)){var s=this._selectArr.indexOf(e),n=this._selectArr[i-1],r=this.canRemove;if(0>s&&e.pos.borderUpon(n.pos)){this._selectArr.push(e);var a=this.canRemove;if(this.connect(n,e,a),this.sign(),this.setSelect(),!r&&a)for(var o=0;i>o;o++)this.select(this._selectArr[o],!0)}else if(i-1>s&&s>=0){for(var o=i-1;o>s;o--)this.unselect(this._selectArr[o]);this._selectArr.splice(s+1,i-1-s),i=this._selectArr.length;var a=this.canRemove;if(this.sign(),this.setSelect(),r&&!a)for(var o=0;i-1>=o;o++)this.select(this._selectArr[o],!1)}}},n.touchEnd=function(){if(this.isState(GridState.Select)){for(var t=this._selectArr.length,e=0;t>e;e++)this.unselect(this._selectArr[e]);this.canRemove?(this._curEffect=TileEffect.NONE,this._connectArr.push(t),this._removeArr.push(t+this._signArr.length),this.remove()):this.setState(GridState.Idle),this._selectArr=[],this.setSelect()
}},n.setSelect=function(){var t=0,e=this._selectArr.length;e>=20?t=4:e>=14?t=3:e>=7?t=2:e>=4&&(t=1);var i;e>0&&(i=this._selectArr[e-1].pos),this.applyFunc(GridCmd.SET_SELECT,i,t)},n.remove=function(){var t=this;this.setState(GridState.Remove),this._effectCntArr=[],this._isShake=!1;for(var e,i=this._selectArr.length,s=0,n=0;i>n;n++){var r=this._selectArr[n];!e&&r.type>0&&!r.key&&(e=r);var a=r.pos.x,o=r.pos.y;this._isFire&&(r.isFire=!0,r.removeFx=TileRemoveFx.Bomb);var h=this.delTile(a,o,null,this.removeInterval*n);s=Math.max(s,h)}if(e){var l=GameData.cacuScore(i);this.addScore(0,l,e.pos,e.type)}var c=this._selectArr[i-1].pos.clone();this.setTimeout(s+this.interval,function(){t.addEffect(i,c),t.repair()})},n.addEffect=function(t,e){var i;t>=20?i=TileEffect.RANDOM:t>=14?i=TileEffect.KIND:t>=7?i=TileEffect.CROSS:t>=4&&(i=TileEffect.BOMB),i&&(this._tileList[e.x][e.y]=this.addTile(e.x,e.y,0,i))},n.repair=function(){for(var t=this,e=[],i=[],s=0;s<this._hor;s++){var n=[];e.push(n);for(var r=0;r<this._ver;r++)this.getTile(s,r)||n.push(r)}var a=this._removeArr[this._removeArr.length-1],o=0;a>=35?o=3:a>=30?o=2:a>=25&&(o=1),o&&this.showPraise(o),!this._isFire&&a>=40&&this.setTimeout(this.moveTime,function(){return t.fire()});for(var h=[],l=0;l<e.length;l++)for(var c=0;c<e[l].length;c++)h.push(new Vector2(l,c));h.sort(SortUtils.random);var u;this._newKey&&(this._newKey=!1,u=h.pop());for(var d=[],f=0,l=this._lastAdd+1;l<this._connectArr.length;l++)f+=this._connectArr[l];if(f>=15){for(var _=Math.floor(f/15),l=0;_>l;l++)d.push(h.pop());this._lastAdd=this._connectArr.length-1}var p;a>=40&&(p=h.pop());var g=[];if(this._curEffect==TileEffect.RANDOM)for(var l=0;3>l;l++)g.push(h.pop());else(this._curEffect==TileEffect.KIND||a>=20)&&g.push(h.pop());for(var s=0;s<e.length;s++){var m=e[s];m.sort(SortUtils.sortNum);for(var l=0;l<m.length;l++){for(var v=null!=u&&s==u.x&&l==u.y,T=null,c=0;c<d.length;c++)if(s==d[c].x&&l==d[c].y){var y=Math.random();T=.7>y?TileEffect.BOMB:TileEffect.CROSS}for(var w=null!=p&&s==p.x&&l==p.y,C=0,c=0;c<g.length;c++)s==g[c].x&&l==g[c].y&&(C=this._times+1);var E=this.addTile(s,l-m.length,null,T,v,w,C);i.push(this.moveTile(E,new Vector2(s,l)))}for(var r=0;r<this._ver;r++)if(r<m[0])i.push(this.moveTile(this.getTile(s,r),new Vector2(s,r+m.length)));else if(m.shift(),0==m.length)break}var F=this.getMaxMoveDuration(i);this.setTimeout(F+this.interval,function(){t.updateMovePosition(i),t.setState(GridState.Idle)})},n.sign=function(){this._signArr=[],this.canRemove&&this.getSign(this._selectArr),this.applyFunc(GridCmd.TILE_SIGN,this._signArr)},n.getSign=function(t){for(var e=0;e<t.length;e++)for(var i=this.getEffect(t[e]),s=t[e].effect==TileEffect.RANDOM,n=0;n<i.length;n++){var r=this.getTile(i[n].x,i[n].y);this._signArr.indexOf(r)<0&&(this._signArr.push(r),s||this.getSign([r]))}},n.doEffect=function(t,e){var i=t.effect;!i&&this.checkFire(t)&&(i=TileEffect.BOMB);var s=0;null==this._effectCntArr[i]?this._effectCntArr[i]=s=1:(this._effectCntArr[i]+=1,s=this._effectCntArr[i]);var n=GameData.cacuEffectScore(t.effect,s),r=0,a=t.pos,o=this.getEffect(t);o.sort(SortUtils.random);for(var h=i==TileEffect.BOMB||i==TileEffect.CROSS,l=i==TileEffect.RANDOM,c=i==TileEffect.KIND,u=0;u<o.length;u++){var d=o[u],f=void 0,_=0,p=this.getTile(d.x,d.y);h?(f=d.y>a.y?Direction.Down:d.y<a.y?Direction.Up:d.x>a.x?Direction.Right:Direction.Left,_=Math.max(Math.abs(d.x-a.x),Math.abs(d.y-a.y))):l?(f=Direction.Center,_=d.x+1):c&&(_=u+1,p&&(p.removeFx=TileRemoveFx.Thunder));var g=this.delTile(d.x,d.y,f,e+_*this.effectInterval);p&&p.key?n+=GameData.keyScore:p&&p.times&&(n+=GameData.timesScore),r=Math.max(r,g)}return this.shake(t,e),t.effect&&this.addScore(e,n,t.pos,0),this._curEffect=Math.max(this._curEffect,t.effect),r},n.shake=function(t,e){var i=this,s=t.pos,n=[],r=this._hor,a=this._ver,o=function(t,e){for(var s=new Vector2(t,e),r=0;r<i._selectArr.length;r++)if(i._selectArr[r].pos.equalTo(s))return;for(var r=0;r<i._signArr.length;r++)if(i._signArr[r].pos.equalTo(s))return;n.push(s)};if(t.effect==TileEffect.BOMB){for(var h=Math.max(0,s.x-3),l=Math.min(r,s.x+4),c=Math.max(0,s.y-3),u=Math.min(a,s.y+4),d=h;l>d;d++)for(var f=c;u>f;f++)o(d,f);for(var d=0;d<n.length;d++){var _=this.getTile(n[d].x,n[d].y);_&&this.shakeTile(_,s,e)}}else if(t.effect==TileEffect.CROSS){for(var h=Math.max(0,s.x-1),l=Math.min(r-1,s.x+1),c=Math.max(0,s.y-1),u=Math.min(a-1,s.y+1),d=0;r>d;d++)o(d,c),o(d,u);for(var d=0;a>d;d++)o(h,d),o(l,d);for(var d=0;d<n.length;d++){var p=n[d],_=this.getTile(p.x,p.y),g=Math.max(Math.abs(p.x-s.x),Math.abs(p.y-s.y)),m=Math.max(Math.abs(s.x-p.x),Math.abs(s.y-p.y)),v=(s.x-p.x)/Math.abs(s.x-p.x)*m+p.x,T=(s.y-p.y)/Math.abs(s.y-p.y)*m+p.y;_&&this.shakeTile(_,new Vector2(v,T),e+g*this.effectInterval*.7)}}},n.getEffect=function(t){var e=this,i=[],s=function(t,s){for(var n=new Vector2(t,s),r=0;r<e._selectArr.length;r++)if(e._selectArr[r].pos.equalTo(n))return;i.push(n)},n=t.pos.x,r=t.pos.y,a=this._hor,o=this._ver,h=t.effect;switch(!h&&this.checkFire(t)&&(h=TileEffect.BOMB),h){case TileEffect.BOMB:for(var l=Math.max(0,n-1),c=Math.min(a,n+2),u=Math.max(0,r-1),d=Math.min(o,r+2),f=l;c>f;f++)for(var _=u;d>_;_++)s(f,_);break;case TileEffect.CROSS:for(var f=0;a>f;f++)s(f,r);for(var f=0;o>f;f++)s(n,f);break;case TileEffect.KIND:var p=this.curSelectType;0==p&&(t.info?p=t.info:(p=this.randomType(),t.info=p));for(var f=0;a>f;f++)for(var _=0;o>_;_++){var g=this.getTile(f,_);g&&g.type==p&&s(f,_)}break;case TileEffect.RANDOM:var m=[];if(t.info)m=t.info;else{for(var f=0;a>f;f++)for(var _=0;o>_;_++){var g=this.getTile(f,_);g&&m.push(g)}m.sort(SortUtils.random),t.info=m}for(var v=Math.min(m.length,23),f=0;v>f;f++)s(m[f].pos.x,m[f].pos.y)}return i},n.fire=function(){this._isFire=!0,this.applyFunc(GameCmd.FIRE),this.applyControllerFunc(ControllerID.Game,GameCmd.FIRE)},n.fireOver=function(){if(this._isFire=!1,this.isState(GridState.Select))for(var t=0;t<this._selectArr.length;t++)this._selectArr[t].isFire=!1,this.sign()},n.addScore=function(t,e,i,s){this.applyControllerFunc(ControllerID.Game,GameCmd.ADD_SCORE,t,e,i,s)},n.addTime=function(){this.applyControllerFunc(ControllerID.Game,GameCmd.ADD_TIME)},n.addTimes=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=0),this._times+=1,this.updateTimes(),this.applyControllerFunc(ControllerID.Game,GameCmd.ADD_TIMES,t,e,i)},n.showPraise=function(t){this.applyControllerFunc(ControllerID.Game,GameCmd.SHOW_PRAISE,t)},n.showChests=function(){this._ver-=1,this._newKey=!1,this._keyCount=0,this.applyFunc(GridCmd.SHOW_CHESTS)},n.hideChests=function(){this._ver+=1,this.applyFunc(GridCmd.HIDE_CHESTS)},n.unlockChest=function(t,e){var i=this;return this._keyCount+=1,this.applyFunc(GridCmd.UNLOCK_CHEST,t,e),this._keyCount>=5?void this.setTimeout(1300,function(){i.applyControllerFunc(ControllerID.Game,GameCmd.SHOW_UNLOCK),i.hideChests(),i.newRow()}):void(this._newKey=!0)},n.newRow=function(){for(var t=[],e=[.65,.85,.95,1],i=Math.random(),s=RandomUtils.limitInteger(0,this._hor-1),n=RandomUtils.limitInteger(0,this._hor-1);s==n;)n=RandomUtils.limitInteger(0,this._hor-1);var r=this.randomType();if(i<e[0])for(var a=0;a<this._hor;a++){var o=this.addTile(a,this._ver-1,r,null,!1,s==a);this._tileList[a][this._ver-1]=o,t.push(o)}else if(i<e[1])for(var a=0;a<this._hor;a++){var h=n==a?TileEffect.KIND:null,o=this.addTile(a,this._ver-1,null,h,!1,s==a);this._tileList[a][this._ver-1]=o,t.push(o)}else if(i<e[2])for(var a=0;a<this._hor;a++){var l=n==a?this._times+1:0,o=this.addTile(a,this._ver-1,r,null,!1,s==a,l);this._tileList[a][this._ver-1]=o,t.push(o)}else for(var a=0;a<this._hor;a++){var h=n==a?TileEffect.RANDOM:null,o=this.addTile(a,this._ver-1,r,h,!1,s==a);this._tileList[a][this._ver-1]=o,t.push(o)}this.applyFunc(GridCmd.NEW_ROW,t)},n.initTileList=function(){this._tileList=[];for(var t=0;t<this._hor;t++){var e=[];this._tileList.push(e)}},n.addTile=function(t,e,i,s,n,r,a){void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===a&&(a=0);var o=new TileData;return o.pos=new Vector2(t,e),o.type=null==i?this.randomType():i,o.effect=s||TileEffect.NONE,o.key=n,o.time=r,o.times=a,s&&(o.type=0),this.creatTile(o),o},n.delTile=function(t,e,i,s){var n=this,r=s+this.removeTime,a=this.getTile(t,e);if(a&&(this._tileList[t][e]=null,null!=i&&a.effect==TileEffect.NONE||i==Direction.Center?this.hitTile(a,this.removeTime,i,s):this.removeTile(a,this.removeTime,s),a.key?(this.setTimeout(s,function(){n.unlockChest(a.pos,a.type)}),this.addScore(s,GameData.keyScore,a.pos,a.type)):a.time?this.addTime():a.times>0&&(this.addTimes(s,a.pos,a.times),this.addScore(s,GameData.timesScore,a.pos,a.type)),(a.effect!=TileEffect.NONE||this.checkFire(a))&&i!=Direction.Center)){var o=this.doEffect(a,s);r=Math.max(r,o)}return r},n.creatTile=function(t){this.applyFunc(GridCmd.TILE_CREATE,t)},n.removeTile=function(t,e,i){var s=this;void 0===i&&(i=0),this.setTimeout(i,function(){s.applyFunc(GridCmd.TILE_REMOVE,t,e)})},n.shakeTile=function(t,e,i){var s=this;void 0===i&&(i=0),this.setTimeout(i,function(){s.applyFunc(GridCmd.TILE_SHAKE,t,e),s._isShake||(s.applyFunc(GridCmd.SHAKE),s._isShake=!0)})},n.hitTile=function(t,e,i,s){var n=this;void 0===s&&(s=0),this.setTimeout(s,function(){n.applyFunc(GridCmd.TILE_HIT,t,e,i)})},n.connect=function(t,e,i){e.isFire=this._isFire,this.applyFunc(GridCmd.TILE_CONNECT,t,e,i)},n.select=function(t,e){t.isFire=this._isFire,this.applyFunc(GridCmd.TILE_SELECT,t,e)},n.unselect=function(t){t.isFire=!1,this.applyFunc(GridCmd.TILE_UNSELECT,t)},n.updateTimes=function(){var t=this._tileList;if(t)for(var e=0;e<this._tileList.length;e++)for(var i=0;i<this._tileList.length;i++){var s=this._tileList[e][i];s&&s.times>0&&(s.times=this._times+1,this.applyFunc(GridCmd.TILE_CHANGE_TIMES,s))}},n.changeRandomTileEffect=function(t,e){for(var i=this.getRandomTile();i.effect!=t;)i=this.getRandomTile();i.effect=e,this.applyFunc(GridCmd.TILE_CHANGE_EFFECT,i)},n.getRandomTile=function(){var t=RandomUtils.limitInteger(0,this._hor-1),e=RandomUtils.limitInteger(0,this._ver-1);return this._tileList[t][e]},n.moveTile=function(t,e){var i=this,s=this.cacuMoveTime(t.pos,e),n=new MoveInfo(t,e,s);return this.setTimeout(RandomUtils.limit(0,80),function(){i.applyFunc(GridCmd.TILE_MOVE,n)}),n},n.getMaxMoveDuration=function(t){for(var e=0,i=0;i<t.length;i++)e=Math.max(e,t[i].duration);return e},n.cacuMoveTime=function(t,e){return Math.sqrt(Math.abs(t.y-e.y))*this.moveTime},n.updateMovePosition=function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].tileData.clone());for(var i=0;i<t.length;i++){var s=t[i];e[i].pos=s.target.clone(),this._tileList[s.target.x][s.target.y]=e[i]}},n.getTile=function(t,e){return this._tileList&&this._tileList[t]&&this._tileList[t][e]},n.randomType=function(){return RandomUtils.limitInteger(1,4)},i(n,"curSelectType",function(){for(var t=0,e=0;e<this._selectArr.length&&(t=this._selectArr[e].type,0==t);e++);return t}),i(n,"canRemove",function(){return this._selectArr.length>=3}),n.checkFire=function(t){return t.isFire},n.setState=function(t){this.isState(GridState.Over)||(this._state=t)},n.isState=function(t){return this._state==t},i(n,"interval",function(){return 50}),i(n,"removeTime",function(){return 300}),i(n,"moveTime",function(){return 450}),i(n,"removeInterval",function(){return 100}),i(n,"effectInterval",function(){return 80}),e}(BaseModel);egret.registerClass(GridModel,"GridModel");var GridState;!function(t){t[t.Start=0]="Start",t[t.Idle=1]="Idle",t[t.Select=2]="Select",t[t.Remove=3]="Remove",t[t.Repair=4]="Repair",t[t.Over=5]="Over"}(GridState||(GridState={}));var Hint=function(t){function e(){t.call(this),this.addChild(this._sprite=new egret.Bitmap)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.show1=function(t,e,i){var s=this;void 0===e&&(e=.5),void 0===i&&(i=.5),this._sprite.texture=RES.getRes(t),AnchorUtils.setAnchorX(this._sprite,e),AnchorUtils.setAnchorY(this._sprite,i),this._sprite.scaleX=this._sprite.scaleY=3.5,this._sprite.alpha=.35;var n=new Tween(this._sprite);n.to={scaleX:1.15,scaleY:1.15,alpha:1},n.duration=200,n.ease=TweenEase.QuadIn,n.start();var r=new Tween(this._sprite);r.to={scaleX:1.1,scaleY:1.1},r.duration=400,r.delay=n.delay+n.duration,r.start();var a=new Tween(this._sprite);a.to={scaleX:1,scaleY:1,alpha:.85},a.duration=20,a.delay=r.delay+r.duration,a.start();var o=new Tween(this._sprite);o.to={scaleX:.4,scaleY:.4,alpha:.35},o.duration=150,o.delay=a.delay+a.duration,o.callBack=function(){return s.destroy()},o.start()},s.show2=function(t,e,i){var s=this;void 0===e&&(e=.5),void 0===i&&(i=.5),this._sprite.texture=RES.getRes(t),AnchorUtils.setAnchorX(this._sprite,e),AnchorUtils.setAnchorY(this._sprite,i),this._sprite.y-=180,this._sprite.alpha=.35,this._sprite.scaleX=this._sprite.scaleY=1;var n=new Tween(this._sprite);n.to={y:this._sprite.y+180,alpha:1},n.duration=200,n.start();var r=new Tween(this._sprite);r.to={scaleX:.35,scaleY:.35,alpha:0},r.duration=500,r.delay=600,r.ease=TweenEase.BackIn,r.callBack=function(){return s.destroy()},r.start()},s.show3=function(t,e,i){var s=this;void 0===e&&(e=.5),void 0===i&&(i=.5),this._sprite.texture=RES.getRes(t),AnchorUtils.setAnchorX(this._sprite,e),AnchorUtils.setAnchorY(this._sprite,i),this._sprite.alpha=0,this._sprite.scaleX=this._sprite.scaleY=.35;var n=new Tween(this._sprite);n.to={scaleX:1,scaleY:1,alpha:1},n.updateFunc=function(){s._sprite.alpha>1&&(s._sprite.alpha=1)},n.duration=500,n.ease=TweenEase.BackOut,n.start();var r=new Tween(this._sprite);r.to={y:this._sprite.y+180,alpha:.35},r.delay=900,r.duration=200,r.callBack=function(){return s.destroy()},r.start()},s.destroy=function(){DisplayUtils.removeFromParent(this),ObjectPool.push(this)},e}(egret.DisplayObjectContainer);egret.registerClass(Hint,"Hint");var Tile=function(t){function e(){t.call(this),this.addChild(this._signIcon=DisplayUtils.createBitmap("gem_bg_2_png")),this.addChild(this._con=new egret.DisplayObjectContainer),this._con.addChild(this._icon=new egret.Bitmap),this._con.addChild(this._key=new egret.Bitmap),this.addChild(this._times=new Times),this.addTouch(),AnchorUtils.setAnchor(this._signIcon,.5)}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.reset=function(){this._con.scaleX=this._con.scaleY=1,this._con.rotation=0,this._con.alpha=1,this.alpha=1,this.rotation=0,this._signIcon.visible=!1,this._isSelect=!1,this._touchObj.touchEnabled=!0,this._isShake=!1},n.addTouch=function(){this.addChild(this._touchObj=new egret.Sprite),DrawUtils.drawCircle(this._touchObj,35,0),this._touchObj.alpha=0,this._touchObj.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),this._touchObj.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouch,this)},n.onTouch=function(){this._callBack&&this._callBack()},n.setIcon=function(t){this._icon.texture=RES.getRes(t),AnchorUtils.setAnchor(this._icon,.5)},n.setOnTouch=function(t){this._callBack=t},n.addTo=function(t){var e=this;t.addChild(this);var i;switch(this._effect){case TileEffect.BOMB:i=ObjectPool.pop("ItemFireInFx");break;case TileEffect.CROSS:i=ObjectPool.pop("ItemWaterInFx");break;case TileEffect.KIND:i=ObjectPool.pop("ItemThunderInFx");break;case TileEffect.RANDOM:i=ObjectPool.pop("ItemStormInFx")}null!=i&&(this._icon.visible=!1,this.addChild(i),i.setCallBack(function(){e._icon.visible=!0}),i.play())},i(n,"sign",void 0,function(t){var e=this._signIcon;if(t&&!e.visible){e.scaleX=e.scaleY=.8;var i=new Tween(e);i.to={scaleX:1,scaleY:1},i.duration=150,i.start()}e.visible=t}),n.select=function(t){var e=this;if(this._time)t?this._timeFx.play():this._timeFx.stopAtFirstFrame(),this._timeFx.visible=!0,this._icon.visible=!1;else if(this._effect>0);else{if(!this._isSelect){var i=500,s=0,n=function(t,i,n){void 0===n&&(n=null);var r=new Tween(e._con);r.to={rotation:t},r.duration=i,r.delay=s,r.callBack=n,r.start(),s+=i};this._con.rotation=170,n(10,.5*i),n(-10,.25*s),n(5,.2*i),n(0,.05*i)}t?this.setIcon("gem_"+this._type+"_l_png"):this.setIcon("gem_"+this._type+"_s_png")}this._isSelect=!0},n.unselect=function(){this._time?(this._timeFx.visible=!1,this._icon.visible=!0):this._effect>0||this.setIcon("gem_"+this._type+"_png"),this._isSelect=!1},n.remove=function(t){this.unEnable(),this.pos=new Vector2(-100,-100);var e=this;this.sign=!1;var i=new Tween(this._con);i.to={scaleX:.2,scaleY:.2},i.duration=t,i.callBack=function(){e.destroy()},i.start(),this._times.visible=!1,this._key.visible=!1},n.hit=function(t,e){var i=this;this.unEnable(),t==Direction.Center&&this.destroy();var s,n;switch(t){case Direction.Left:n=400,s=-RandomUtils.limit(.4,1.05);break;case Direction.Right:n=400,s=RandomUtils.limit(.4,1.05);break;case Direction.Up:n=600,s=RandomUtils.limit(.05,.25)*(Math.random()>.5?1:-1);break;case Direction.Down:n=120,s=RandomUtils.limit(2.05,2.25)*(Math.random()>.5?1:-1)}var r=Math.PI/2*s,a=n*Math.sin(r),o=n*Math.cos(r),h=new Tween(this),l=this.x,c=this.y;h.updateFunc=function(t){t/=1e3;var e=a*t,s=-o*t+1200*t*t/2;i.x=l+e,i.y=c+s,i.alpha=1-1.4*Math.max(t-.5,0),i.rotation=Math.atan(s/e)/Math.PI*180},h.callBack=function(){i.destroy()},h.duration=1200,h.start(),this._times.visible=!1,this._key.visible=!1},n.shake=function(t,e){var i=this;if(!this._isShake){this._isShake=!0;var s=MathUtils.getDistance(this.x,this.y,t,e),n=MathUtils.getRadian2(t,e,this.x,this.y),r=400/Math.sqrt(s),a=650,o=0,h=function(t,e,s){void 0===s&&(s=null);var a=new Tween(i._con);a.to={x:r*Math.cos(n)*t,y:r*Math.sin(n)*t},a.duration=e,a.delay=o,a.callBack=s,a.start(),o+=e};h(1,60),h(0,a/7),h(-.7,a/7),h(0,a/7),h(.4,a/7),h(0,a/7),h(-.1,a/7),h(0,a/7,function(){i._isShake=!1})}},n.unEnable=function(){this._signIcon.visible=!1,this.pos=new Vector2(0,100),this._touchObj.touchEnabled=!1},n.moveTo=function(t,e,i){var s=this;void 0===i&&(i=null);var n=new Tween(this),r=this.y,a=0,o=0,h=6e3,l=!1;n.to={y:t.y},n.updateFunc=function(e){if(l)return void(s.y=t.y);if(e/=1e3,e-=o,s.y=a*e+r+.5*h*e*e,s.y>=t.y){s.y=t.y;var i=-h*e*.32;-450>i?(a=i,o+=e,r=t.y):l=!0}},n.duration=e,n.callBack=function(){if(i(),s._showKey){var t=ObjectPool.pop("KeyInFx");s.addChild(t),t.play(),s._showKey=!1}},n.start()},i(n,"type",void 0,function(t){this._type=t,0!=this._type&&this.setIcon("gem_"+t+"_png")}),i(n,"effect",void 0,function(t){this._effect=t,this._effect!=TileEffect.NONE&&this.setIcon("item_"+t+"_png")}),i(n,"key",void 0,function(t){this._showKey=t,t?(this._key.visible=!0,this._key.texture=RES.getRes("key_"+this._type+"_png"),AnchorUtils.setAnchor(this._key,.5)):this._key.visible=!1}),i(n,"time",void 0,function(t){if(this._time=t,this._timeFx&&this._timeFx.destroy(),this._time){switch(this.setIcon("time_"+this._type+"_png"),this._type){case 1:this._timeFx=ObjectPool.pop("TimeRedSelectFx");break;case 2:this._timeFx=ObjectPool.pop("TimeBlueSelectFx");break;case 3:this._timeFx=ObjectPool.pop("TimeYellowSelectFx");break;case 4:this._timeFx=ObjectPool.pop("TimeGreenSelectFx")}this.addChild(this._timeFx),this._timeFx.visible=!1}}),i(n,"times",void 0,function(t){t?(this._times.visible=!0,this._times.setTimes(t)):this._times.visible=!1}),i(n,"pos",function(){return this._pos},function(t){this._pos=t}),n.destroy=function(){TweenManager.removeTween(this),DisplayUtils.removeFromParent(this),ObjectPool.push(this)},e}(egret.DisplayObjectContainer);egret.registerClass(Tile,"Tile");var TileData=function(){function t(){this.effect=TileEffect.NONE,this.removeFx=TileRemoveFx.Smoke,this.info=null,this.key=!1,this.time=!1,this.times=0,this.isFire=!1}var e=(__define,t),i=e.prototype;return i.clone=function(){var e=new t;return e.pos=this.pos.clone(),e.type=this.type,e.effect=this.effect,e.info=this.info,e.key=this.key,e.time=this.time,e.times=this.times,e.isFire=this.isFire,e},t}();egret.registerClass(TileData,"TileData");var TileEffect;!function(t){t[t.NONE=0]="NONE",t[t.BOMB=1]="BOMB",t[t.CROSS=2]="CROSS",t[t.KIND=3]="KIND",t[t.RANDOM=4]="RANDOM"}(TileEffect||(TileEffect={}));var TileRemoveFx;!function(t){t[t.Smoke=0]="Smoke",t[t.Bomb=1]="Bomb",t[t.Thunder=3]="Thunder"}(TileRemoveFx||(TileRemoveFx={}));var Times=function(t){function e(){t.call(this),this.addChild(this._bg=DisplayUtils.createBitmap("times_png")),AnchorUtils.setAnchor(this._bg,.5),this.addChild(this._label=new Label),this._label.width=120,this._label.size=24,this._label.stroke=3,this._label.textColor=0,this._label.strokeColor=16777215,AnchorUtils.setAnchor(this._label,.5),this._label.y=5}__extends(e,t);var i=(__define,e),s=i.prototype;return s.setTimes=function(t){this._label.text="x"+t},s.destroy=function(){DisplayUtils.removeFromParent(this),ObjectPool.push(this)},e}(egret.DisplayObjectContainer);egret.registerClass(Times,"Times");var Main=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),EgretExpandManager.init(),StageUtils.stage.removeChildren(),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},s.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},s.onResourceLoadComplete=function(t){"preload"==t.groupName?(this._loadingScene=SceneManager.instance.open(SceneID.Loading),RES.loadGroup("loading")):"loading"==t.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},s.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},s.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},s.onResourceProgress=function(t){"loading"==t.groupName&&this._loadingScene.setProgress(t.itemsLoaded,t.itemsTotal)},s.createGameScene=function(){SceneManager.instance.close(SceneID.Loading),SceneManager.instance.open(SceneID.Game)},e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var BombElement=function(t){function e(){t.call(this),this.flyDistance=0,this.WIDTH=0,this.HEIGHT=0,this.createView()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createView=function(){this.f1=DisplayUtils.createBitmap("fireparticle_png"),this.f2=DisplayUtils.createBitmap("fireparticle_png"),this.f3=DisplayUtils.createBitmap("fireparticle_png"),this.f4=DisplayUtils.createBitmap("fireparticle_png"),this.flyDistance=this.f1.width/2,this.WIDTH=this.f1.width,this.HEIGHT=this.f1.height,this.f1.anchorOffsetX=.5*this.f1.width,this.f1.anchorOffsetY=.5*this.f1.height,this.f2.anchorOffsetX=.5*this.f2.width,this.f2.anchorOffsetY=.5*this.f2.height,this.f3.anchorOffsetX=.5*this.f3.width,this.f3.anchorOffsetY=.5*this.f3.height,this.f4.anchorOffsetX=.5*this.f4.width,this.f4.anchorOffsetY=.5*this.f4.height,this.f2.scaleX=this.f2.scaleY=.5,this.f3.scaleX=this.f3.scaleY=.5,this.f4.scaleX=this.f4.scaleY=.5,this.addChild(this.f2),this.addChild(this.f3),this.addChild(this.f4),this.addChild(this.f1)},s.playAni=function(){var t=this,i=new Tween(this.f1);i.to={x:-this.flyDistance,y:-this.flyDistance,alpha:.2,rotation:-180},i.duration=e.TIME_ROTATION,i.ease=TweenEase.CircOut,i.start();var s=new Tween(this.f2,i);s.to={x:this.flyDistance,y:this.flyDistance,alpha:.2,rotation:-180},s.start();var n=new Tween(this.f3,i);n.to={x:-this.flyDistance,y:this.flyDistance,alpha:.2,rotation:-180},n.start();var r=new Tween(this.f4,i);r.to={x:this.flyDistance,y:-this.flyDistance,alpha:.2,rotation:-180},r.callBack=function(){return t.done()},r.start()},s.reset=function(){this.f1.x=0,this.f1.y=0,this.f1.alpha=1,this.f1.rotation=0,this.f2.x=0,this.f2.y=0,this.f2.alpha=1,this.f2.rotation=0,this.f3.x=0,this.f3.y=0,this.f3.alpha=1,this.f3.rotation=0,this.f4.x=0,this.f4.y=0,this.f4.alpha=1,this.f4.rotation=0},s.done=function(){this.dispatchEvent(new egret.Event("aniDone"))},e.TIME_ROTATION=400,e}(egret.Sprite);egret.registerClass(BombElement,"BombElement");var Fx=function(t){function e(){t.call(this),this.init(),TimerManager.doFrame(1,0,this.update,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){},s.update=function(t){this.anim&&(this._fr?this.anim.frameRate=TimerManager.getTimeScale()*this._fr:this._fr=this.anim.frameRate)},s.play=function(){this.visible=!0},s.stopAtFirstFrame=function(){this.visible=!0},s.setCallBack=function(t){this._callBack=t},s.onComplete=function(){this.visible=!1,this.destroy(),this._callBack&&this._callBack()},s.destroy=function(){DisplayUtils.removeFromParent(this),ObjectPool.push(this)},e}(egret.Sprite);egret.registerClass(Fx,"Fx");var BombFx=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this.f1=new BombElement,this.f2=new BombElement,this.f3=new BombElement,this.f4=new BombElement,this.f5=new BombElement,this.f6=new BombElement,this.f7=new BombElement,this.f8=new BombElement,this.glowF=DisplayUtils.createBitmap("fireparticle_png"),this.white=new egret.Shape,this.white.graphics.beginFill(16777215,1),this.white.graphics.drawRect(-this.glowF.width,-this.glowF.height,2*this.glowF.width,2*this.glowF.height),this.white.graphics.endFill(),this.glowF.x=-this.glowF.width/2,this.glowF.y=-this.glowF.height/2,e.FLYDISTANCE=this.f1.WIDTH,this.f5.scaleX=this.f5.scaleY=.5,this.f6.scaleX=this.f6.scaleY=.5,this.f7.scaleX=this.f7.scaleY=.5,this.f8.scaleX=this.f8.scaleY=.5,this.addChild(this.f2),this.addChild(this.f3),this.addChild(this.f4),this.addChild(this.f5),this.addChild(this.f6),this.addChild(this.f7),this.addChild(this.f8),this.addChild(this.f1),this.addChild(this.white),this.addChild(this.glowF),this.white.mask=this.glowF,this.f8.addEventListener("aniDone",this.onComplete,this)},s.play=function(){var i=this;t.prototype.play.call(this),this.reset();var s=new Tween(this.white);s.to={rotation:-90,alpha:0},s.duration=e.TIME_ROTATION,s.ease=TweenEase.CircIn,s.start();var n=new Tween(this.f1);n.to={rotation:-90},n.duration=e.TIME_ROTATION,n.ease=TweenEase.CircIn,n.start();var r=new Tween(this.f2,n);r.start();var a=new Tween(this.f3,n);a.start();var o=new Tween(this.f4,n);o.start();var h=new Tween(this.f5,n);h.start();var l=new Tween(this.f6,n);l.start();var c=new Tween(this.f7,n);c.start();var u=new Tween(this.f8,n);u.callBack=function(){return i.ani2()},u.start()},s.ani2=function(){var t=this,i=new Tween(this.f1);i.to={x:-e.FLYDISTANCE},i.duration=e.TIME_FLY,i.ease=TweenEase.CircIn,i.start();var s=new Tween(this.f2,i);s.to={y:e.FLYDISTANCE},s.start();var n=new Tween(this.f3,i);n.to={x:e.FLYDISTANCE},n.start();var r=new Tween(this.f4,i);r.to={y:-e.FLYDISTANCE},r.start();var a=new Tween(this.f5,i);a.to={x:-e.FLYDISTANCE,y:-e.FLYDISTANCE},a.start();var o=new Tween(this.f6,i);o.to={x:e.FLYDISTANCE,y:e.FLYDISTANCE},o.start();var h=new Tween(this.f7,i);h.to={x:-e.FLYDISTANCE,y:e.FLYDISTANCE},h.start();var l=new Tween(this.f8,i);l.to={x:e.FLYDISTANCE,y:-e.FLYDISTANCE},l.callBack=function(){return t.ani3()},l.start()},s.ani3=function(){this.f1.playAni(),this.f2.playAni(),this.f3.playAni(),this.f4.playAni(),this.f5.playAni(),this.f6.playAni(),this.f7.playAni(),this.f8.playAni()},s.reset=function(){this.f1.x=0,this.f1.y=0,this.f2.x=0,this.f2.y=0,this.f3.x=0,this.f3.y=0,this.f4.x=0,this.f4.y=0,this.f5.x=0,this.f5.y=0,this.f6.x=0,this.f6.y=0,this.f7.x=0,this.f7.y=0,this.f8.x=0,this.f8.y=0,this.f1.reset(),this.f2.reset(),this.f3.reset(),this.f4.reset(),this.f5.reset(),this.f6.reset(),this.f7.reset(),this.f8.reset(),this.f1.scaleX=this.f1.scaleY=1,this.f2.scaleX=this.f2.scaleY=1,this.f3.scaleX=this.f3.scaleY=1,this.f4.scaleX=this.f4.scaleY=1,this.f5.scaleX=this.f5.scaleY=.5,this.f6.scaleX=this.f6.scaleY=.5,this.f7.scaleX=this.f7.scaleY=.5,this.f8.scaleX=this.f8.scaleY=.5,this.f1.rotation=0,this.f2.rotation=0,this.f3.rotation=0,this.f4.rotation=0,this.f5.rotation=0,this.f6.rotation=0,this.f7.rotation=0,this.f8.rotation=0,this.white.rotation=0,this.white.alpha=1},e.FLYDISTANCE=0,e.TIME_ROTATION=100,e.TIME_FLY=200,e}(Fx);egret.registerClass(BombFx,"BombFx");var DoorFx=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){var t=RES.getRes("door_json"),i=RES.getRes("door_png"),s=new egret.MovieClipDataFactory(t,i);this.anim=new egret.MovieClip(s.generateMovieClipData("door")),this.anim.frameRate=e.FRAMERATE,this.addChild(this.anim)},s.playOpen=function(){t.prototype.play.call(this),this.anim.gotoAndPlay("open")},s.playStatic=function(){t.prototype.play.call(this),this.anim.gotoAndStop("static")},s.playShakeClosed=function(){t.prototype.play.call(this),this.anim.gotoAndPlay("shake1")},s.playShakeOpened=function(){t.prototype.play.call(this),this.anim.gotoAndPlay("shake2")},e.FRAMERATE=12,e}(Fx);egret.registerClass(DoorFx,"DoorFx");var FireFx=function(t){function e(){t.apply(this,arguments),this.timecount=0,this.currentFrameIndex=0}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this.bitmapArray=new Array;for(var t=1;t<e.TOTALFRAME+1;t++){var i=DisplayUtils.createBitmap("fire000"+t+"_png");this.bitmapArray.push(i),this.addChild(i),i.y=i.height,i.x=-i.width/2}},s.play=function(){t.prototype.play.call(this),this.reset()},s.stopAni=function(){var t=this,i=new Tween(this);i.to={y:this.anim[0].height+StageUtils.stageH},i.duration=e.TIME_DISAPPEAR,i.callBack=function(){return t.onComplete()},i.start(),egret.Tween.get(this).to({y:this.anim[0].height+this.stage.stageHeight},e.TIME_DISAPPEAR).call(this.onComplete,this),this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},s.reset=function(){for(var t=0;t<e.TOTALFRAME;t++)this.bitmapArray[t].x=-this.bitmapArray[t].width/2,this.bitmapArray[t].y=-this.bitmapArray[t].height,this.bitmapArray[t].visible=!1;this.bitmapArray[0].visible=!0,this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},s.onEnterFrame=function(t){if(this.timecount++,this.timecount%Math.round(60/e.FRAMERATE)==0){this.timecount=0;for(var i=0;i<e.TOTALFRAME;i++)this.bitmapArray[i].visible=!1;this.bitmapArray[this.currentFrameIndex].visible=!0,this.currentFrameIndex++,this.currentFrameIndex>e.TOTALFRAME-1&&(this.currentFrameIndex=0)}},e.TIME_DISAPPEAR=200,e.FRAMERATE=8,e.TOTALFRAME=6,e}(Fx);egret.registerClass(FireFx,"FireFx");var ItemFireInFx=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){var t=RES.getRes("items_in_json"),i=RES.getRes("items_in_png"),s=new egret.MovieClipDataFactory(t,i);this.anim=new egret.MovieClip(s.generateMovieClipData("item_fire_in")),this.anim.frameRate=e.FRAMERATE,this.addChild(this.anim),this.anim.addEventListener(egret.Event.COMPLETE,this.onComplete,this)},s.play=function(){t.prototype.play.call(this),this.anim.gotoAndPlay(1)},e.FRAMERATE=14,e}(Fx);egret.registerClass(ItemFireInFx,"ItemFireInFx");var ItemStormInFx=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){var t=RES.getRes("items_in_json"),i=RES.getRes("items_in_png"),s=new egret.MovieClipDataFactory(t,i);this.anim=new egret.MovieClip(s.generateMovieClipData("item_storm_in")),this.anim.frameRate=e.FRAMERATE,this.addChild(this.anim),this.anim.addEventListener(egret.Event.COMPLETE,this.onComplete,this)},s.play=function(){t.prototype.play.call(this),this.anim.gotoAndPlay(1)},e.FRAMERATE=14,e}(Fx);egret.registerClass(ItemStormInFx,"ItemStormInFx");
var ItemThunderInFx=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){var t=RES.getRes("items_in_json"),i=RES.getRes("items_in_png"),s=new egret.MovieClipDataFactory(t,i);this.anim=new egret.MovieClip(s.generateMovieClipData("item_thunder_in")),this.anim.frameRate=e.FRAMERATE,this.addChild(this.anim),this.anim.addEventListener(egret.Event.COMPLETE,this.onComplete,this)},s.play=function(){t.prototype.play.call(this),this.anim.gotoAndPlay(1)},e.FRAMERATE=14,e}(Fx);egret.registerClass(ItemThunderInFx,"ItemThunderInFx");var ItemWaterInFx=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){var t=RES.getRes("items_in_json"),i=RES.getRes("items_in_png"),s=new egret.MovieClipDataFactory(t,i);this.anim=new egret.MovieClip(s.generateMovieClipData("item_water_in")),this.anim.frameRate=e.FRAMERATE,this.addChild(this.anim),this.anim.addEventListener(egret.Event.COMPLETE,this.onComplete,this)},s.play=function(){t.prototype.play.call(this),this.anim.gotoAndPlay(1)},e.FRAMERATE=14,e}(Fx);egret.registerClass(ItemWaterInFx,"ItemWaterInFx");var KeyInFx=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){var t=RES.getRes("items_in_json"),i=RES.getRes("items_in_png"),s=new egret.MovieClipDataFactory(t,i);this.anim=new egret.MovieClip(s.generateMovieClipData("key_in")),this.anim.frameRate=e.FRAMERATE,this.addChild(this.anim),this.anim.addEventListener(egret.Event.COMPLETE,this.onComplete,this)},s.play=function(){t.prototype.play.call(this),this.anim.gotoAndPlay(1)},e.FRAMERATE=12,e}(Fx);egret.registerClass(KeyInFx,"KeyInFx");var SmokeFx=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){var t=RES.getRes("smoke_json"),e=RES.getRes("smoke_png"),i=new egret.MovieClipDataFactory(t,e);this.anim=new egret.MovieClip(i.generateMovieClipData("smoke")),this.anim.frameRate=WaterFx.TIME_ROTATION,this.addChild(this.anim),this.anim.addEventListener(egret.Event.COMPLETE,this.onComplete,this)},s.play=function(){t.prototype.play.call(this),this.anim.gotoAndPlay(1)},e}(Fx);egret.registerClass(SmokeFx,"SmokeFx");var StormFx=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){var t=RES.getRes("storm_json"),i=RES.getRes("storm_png"),s=new egret.MovieClipDataFactory(t,i);this.anim=new egret.MovieClip(s.generateMovieClipData("storm")),this.anim.frameRate=e.TIME_ANIM,this.addChild(this.anim),this.anim.gotoAndPlay(1,-1)},s.play=function(){var i=this;t.prototype.play.call(this);var s=new Tween(this.anim);s.to={x:StageUtils.stageW+e.WIDTH/2},s.duration=e.TIME_MOVE,s.callBack=function(){return i.onComplete()},s.start()},s.reset=function(){this.anim.x=0},e.TIME_ANIM=12,e.WIDTH=500,e.TIME_MOVE=1200,e}(Fx);egret.registerClass(StormFx,"StormFx");var ThunderFx=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){var t=RES.getRes("thunder_json"),i=RES.getRes("thunder_png"),s=new egret.MovieClipDataFactory(t,i);this.anim=new egret.MovieClip(s.generateMovieClipData("thunder")),this.anim.frameRate=e.TIME_ANIM,this.anim.gotoAndPlay(1,-1),this.addChild(this.anim),this.star=DisplayUtils.createBitmap("thunderstar_png"),this.star.anchorOffsetX=.5*this.star.width,this.star.anchorOffsetY=.5*this.star.height,this.addChild(this.star)},s.play=function(){var i=this;t.prototype.play.call(this),this.reset();var s=new Tween(this.anim);s.to={y:0},s.duration=e.TIME_IN,s.start();var n=new Tween(this.star);n.to={scaleX:1,scaleY:1},n.duration=e.TIME_IN,n.callBack=function(){return i.ani2()},n.start()},s.ani2=function(){var t=this,i=new Tween(this.star);i.to={scaleX:1.4,scaleY:1.4,rotation:-10},i.duration=100,i.loop=!0,i.start();var s=new Tween(this.star);s.duration=e.TIME_KEEP,s.callBack=function(){return t.ani3()},s.start()},s.ani3=function(){var t=this,i=new Tween(this.anim);i.to={scaleY:0,y:30},i.duration=e.TIME_OUT,i.start();var s=new Tween(this.star);s.to={scaleX:.3,scaleY:.3,rotation:-90,alpha:.3},s.duration=e.TIME_OUT,s.callBack=function(){return t.onComplete()},s.start()},s.reset=function(){this.anim.y=-e.HEIGHT,this.anim.scaleY=1,this.star.scaleX=this.star.scaleY=.5,this.star.alpha=1,this.star.rotation=0},e.TIME_ANIM=8,e.HEIGHT=750,e.TIME_IN=100,e.TIME_KEEP=400,e.TIME_OUT=100,e}(Fx);egret.registerClass(ThunderFx,"ThunderFx");var TimeBlueSelectFx=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){var t=RES.getRes("time_select_json"),i=RES.getRes("time_select_png"),s=new egret.MovieClipDataFactory(t,i);this.anim=new egret.MovieClip(s.generateMovieClipData("time_blue_select")),this.anim.frameRate=e.FRAMERATE,this.addChild(this.anim),this.anim.addEventListener(egret.Event.COMPLETE,this.onComplete,this)},s.play=function(){t.prototype.play.call(this),this.anim.gotoAndPlay(1,-1)},s.stopAtFirstFrame=function(){t.prototype.stopAtFirstFrame.call(this),this.anim.gotoAndStop(1)},e.FRAMERATE=9,e}(Fx);egret.registerClass(TimeBlueSelectFx,"TimeBlueSelectFx");var TimeGreenSelectFx=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){var t=RES.getRes("time_select_json"),i=RES.getRes("time_select_png"),s=new egret.MovieClipDataFactory(t,i);this.anim=new egret.MovieClip(s.generateMovieClipData("time_green_select")),this.anim.frameRate=e.FRAMERATE,this.addChild(this.anim),this.anim.addEventListener(egret.Event.COMPLETE,this.onComplete,this)},s.play=function(){t.prototype.play.call(this),this.anim.gotoAndPlay(1,-1)},s.stopAtFirstFrame=function(){t.prototype.stopAtFirstFrame.call(this),this.anim.gotoAndStop(1)},e.FRAMERATE=9,e}(Fx);egret.registerClass(TimeGreenSelectFx,"TimeGreenSelectFx");var TimeRedSelectFx=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){var t=RES.getRes("time_select_json"),i=RES.getRes("time_select_png"),s=new egret.MovieClipDataFactory(t,i);this.anim=new egret.MovieClip(s.generateMovieClipData("time_red_select")),this.anim.frameRate=e.FRAMERATE,this.addChild(this.anim),this.anim.addEventListener(egret.Event.COMPLETE,this.onComplete,this)},s.play=function(){t.prototype.play.call(this),this.anim.gotoAndPlay(1,-1)},s.stopAtFirstFrame=function(){t.prototype.stopAtFirstFrame.call(this),this.anim.gotoAndStop(1)},e.FRAMERATE=9,e}(Fx);egret.registerClass(TimeRedSelectFx,"TimeRedSelectFx");var TimeYellowSelectFx=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){var t=RES.getRes("time_select_json"),i=RES.getRes("time_select_png"),s=new egret.MovieClipDataFactory(t,i);this.anim=new egret.MovieClip(s.generateMovieClipData("time_yellow_select")),this.anim.frameRate=e.FRAMERATE,this.addChild(this.anim),this.anim.addEventListener(egret.Event.COMPLETE,this.onComplete,this)},s.play=function(){t.prototype.play.call(this),this.anim.gotoAndPlay(1,-1)},s.stopAtFirstFrame=function(){t.prototype.stopAtFirstFrame.call(this),this.anim.gotoAndStop(1)},e.FRAMERATE=9,e}(Fx);egret.registerClass(TimeYellowSelectFx,"TimeYellowSelectFx");var WaterFx=function(t){function e(){t.apply(this,arguments),this.flyDistance=0,this.maskWidth=0,this.maskHeight=0}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){var t=RES.getRes("watercenter_json"),i=RES.getRes("watercenter_png"),s=new egret.MovieClipDataFactory(t,i);this.watercenter=new egret.MovieClip(s.generateMovieClipData("water")),this.watercenter.frameRate=e.TIME_ROTATION,this.watercenter.x=0,this.watercenter.y=0,this.watercenter.gotoAndPlay(1,-1),this.waterspout1=new WaterSpout,this.waterspout2=new WaterSpout,this.waterspout3=new WaterSpout,this.waterspout4=new WaterSpout,this.waterspout2.rotation=90,this.waterspout3.rotation=180,this.waterspout4.rotation=270,this.maskWidth=this.waterspout1.WIDTH+15,this.maskHeight=this.waterspout1.HEIGHT+50,this.mask1=new egret.Shape,this.mask2=new egret.Shape,this.mask3=new egret.Shape,this.mask4=new egret.Shape,this.mask1.graphics.beginFill(16777215,1),this.mask1.graphics.drawRect(-this.maskWidth/2,-this.maskHeight,this.maskWidth,this.maskHeight),this.mask1.graphics.endFill(),this.mask2.graphics.beginFill(16777215,1),this.mask2.graphics.drawRect(0,-this.maskWidth/2,this.maskHeight,this.maskWidth),this.mask2.graphics.endFill(),this.mask3.graphics.beginFill(16777215,1),this.mask3.graphics.drawRect(-this.maskWidth/2,0,this.maskWidth,this.maskHeight),this.mask3.graphics.endFill(),this.mask4.graphics.beginFill(16777215,1),this.mask4.graphics.drawRect(-this.maskHeight,-this.maskWidth/2,this.maskHeight,this.maskWidth),this.mask4.graphics.endFill(),this.addChild(this.waterspout1),this.addChild(this.waterspout2),this.addChild(this.waterspout3),this.addChild(this.waterspout4),this.addChild(this.mask1),this.addChild(this.mask2),this.addChild(this.mask3),this.addChild(this.mask4),this.waterspout1.mask=this.mask1,this.waterspout2.mask=this.mask2,this.waterspout3.mask=this.mask3,this.waterspout4.mask=this.mask4,this.waterspout1.y=this.waterspout1.HEIGHT,this.waterspout2.x=-this.waterspout2.HEIGHT,this.waterspout3.y=-this.waterspout3.HEIGHT,this.waterspout4.x=this.waterspout4.HEIGHT,this.waterspout1.alpha=.8,this.waterspout1.scaleX=.7,this.waterspout2.alpha=.8,this.waterspout2.scaleX=.7,this.waterspout3.alpha=.8,this.waterspout3.scaleX=.7,this.waterspout4.alpha=.8,this.waterspout4.scaleX=.7,this.addChild(this.watercenter)},s.play=function(){var i=this;t.prototype.play.call(this),this.reset();var s=new Tween(this.waterspout1);s.to={y:.4*this.waterspout1.HEIGHT,alpha:1,scaleX:1,scaleY:1},s.duration=e.TIME_SPOUTAPPEAR,s.start();var n=new Tween(this.waterspout2);n.to={x:.4*-this.waterspout2.HEIGHT,alpha:1,scaleX:1,scaleY:1},n.duration=e.TIME_SPOUTAPPEAR,n.start();var r=new Tween(this.waterspout3);r.to={y:.4*-this.waterspout2.HEIGHT,alpha:1,scaleX:1,scaleY:1},r.duration=e.TIME_SPOUTAPPEAR,r.start();var a=new Tween(this.waterspout4);a.to={x:.4*this.waterspout4.HEIGHT,alpha:1,scaleX:1,scaleY:1},a.duration=e.TIME_SPOUTAPPEAR,a.callBack=function(){return i.ani2()},a.start()},s.ani2=function(){var t=this;this.waterspout1.showGlow(e.TIME_SPOUTKEEP),this.waterspout2.showGlow(e.TIME_SPOUTKEEP),this.waterspout3.showGlow(e.TIME_SPOUTKEEP),this.waterspout4.showGlow(e.TIME_SPOUTKEEP);var i=new Tween(this.watercenter);i.to={alpha:.8},i.duration=e.TIME_SPOUTDISAPPEAR,i.start();var s=new Tween(this.waterspout1);s.to={y:0},s.duration=e.TIME_SPOUTKEEP,s.start();var n=new Tween(this.waterspout2);n.to={x:0},n.duration=e.TIME_SPOUTKEEP,n.start();var r=new Tween(this.waterspout3);r.to={y:0},r.duration=e.TIME_SPOUTKEEP,r.start();var a=new Tween(this.waterspout4);a.to={x:0},a.duration=e.TIME_SPOUTKEEP,a.callBack=function(){return t.ani3()},a.start()},s.ani3=function(){var t=this,i=new Tween(this.watercenter);i.to={alpha:.3,scaleX:.3,scaleY:.3},i.duration=e.TIME_SPOUTDISAPPEAR,i.start();var s=new Tween(this.waterspout1);s.to={y:0,alpha:.3,scaleX:.3},s.duration=e.TIME_SPOUTDISAPPEAR,s.start();var n=new Tween(this.waterspout2);n.to={x:0,alpha:.3,scaleX:.3},n.duration=e.TIME_SPOUTDISAPPEAR,n.start();var r=new Tween(this.waterspout3);r.to={y:0,alpha:.3,scaleX:.3},r.duration=e.TIME_SPOUTDISAPPEAR,r.start();var a=new Tween(this.waterspout4);a.to={x:0,alpha:.3,scaleX:.3},a.duration=e.TIME_SPOUTDISAPPEAR,a.callBack=function(){return t.onComplete()},a.start()},s.reset=function(){this.watercenter.alpha=1,this.watercenter.scaleX=this.watercenter.scaleY=1,this.waterspout1.y=this.waterspout1.HEIGHT,this.waterspout2.x=-this.waterspout2.HEIGHT,this.waterspout3.y=-this.waterspout3.HEIGHT,this.waterspout4.x=this.waterspout4.HEIGHT,this.waterspout1.alpha=.8,this.waterspout1.scaleX=.7,this.waterspout2.alpha=.8,this.waterspout2.scaleX=.7,this.waterspout3.alpha=.8,this.waterspout3.scaleX=.7,this.waterspout4.alpha=.8,this.waterspout4.scaleX=.7,this.waterspout1.scaleX=1,this.waterspout2.scaleX=1,this.waterspout3.scaleX=1,this.waterspout4.scaleX=1,this.waterspout1.reset(),this.waterspout2.reset(),this.waterspout3.reset(),this.waterspout4.reset()},e.TIME_ROTATION=16,e.TIME_SPOUTAPPEAR=400,e.TIME_SPOUTDISAPPEAR=200,e.TIME_SPOUTKEEP=400,e}(Fx);egret.registerClass(WaterFx,"WaterFx");var WaterSpout=function(t){function e(){t.call(this),this.WIDTH=0,this.HEIGHT=0,this.createView()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createView=function(){this.spout=DisplayUtils.createBitmap("waterspout_png"),this.glowmask=DisplayUtils.createBitmap("waterspout_png"),this.end=DisplayUtils.createBitmap("waterend_png"),this.end2=DisplayUtils.createBitmap("waterend_png"),this.spout.anchorOffsetX=.5*this.spout.width,this.spout.anchorOffsetY=this.spout.height,this.glowmask.anchorOffsetX=.5*this.glowmask.width,this.glowmask.anchorOffsetY=this.glowmask.height,this.end.anchorOffsetX=.5*this.end.width,this.end.y=-this.spout.height,this.end2.anchorOffsetX=.5*this.end2.width,this.end2.scaleX=-1,this.end2.y=-this.spout.height,this.end2.alpha=0,this.WIDTH=this.end.width,this.HEIGHT=this.spout.height,this.glow=new egret.Shape,this.glow.graphics.beginFill(16777215,1),this.glow.graphics.drawRect(-this.end.width/2,-this.spout.height,this.end.width,this.spout.height),this.glow.graphics.endFill(),this.addChild(this.spout),this.addChild(this.glow),this.addChild(this.glowmask),this.glow.mask=this.glowmask,this.glow.alpha=0,this.addChild(this.end),this.addChild(this.end2),egret.Tween.get(this.end,{loop:!0}).to({alpha:0},50).wait(100).to({alpha:1},50).wait(100),egret.Tween.get(this.end2,{loop:!0}).to({alpha:1},50).wait(100).to({alpha:0},50).wait(100)},s.showGlow=function(t){var e=new Tween(this.glow);e.to={alpha:.5},e.duration=t,e.start()},s.playAni=function(){},s.reset=function(){this.glow.alpha=0},e}(egret.Sprite);egret.registerClass(WaterSpout,"WaterSpout");var Direction;!function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Up=2]="Up",t[t.Down=3]="Down",t[t.Center=4]="Center"}(Direction||(Direction={}));var FloatScore=function(t){function e(){t.call(this),this.addChild(this._text=new Label),this._text.width=400,this._text.size=45,this._text.stroke=3,AnchorUtils.setAnchorX(this._text,.5)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.show=function(t,e){var i=this;this.visible=!0,this._text.text=t+"";var s=StageUtils.stageW;15*this._text.text.length+this.x>s?this.x=s-15*this._text.text.length:this.x-15*this._text.text.length<0&&(this.x=15*this._text.text.length);var n=16777215;switch(e){case 1:n=16500416;break;case 2:n=5436916;break;case 3:n=16707200;break;case 4:n=13366658}this._text.textColor=n;var r=0,a=new Tween(this._text);a.from={x:0,y:20,alpha:1,scaleX:0,scaleY:.5},a.to={y:-70,scaleX:1.1,scaleY:1},a.duration=200,a.start(),r+=a.duration;var o=new Tween(this._text);o.to={y:-80,scaleX:1},o.duration=100,o.delay=r,o.start(),r+=o.duration;var h=new Tween(this._text);h.to={y:-160},h.duration=600,h.delay=r,h.start(),r+=h.duration;var l=new Tween(this._text);l.to={y:-170,scaleX:1.3,scaleY:1.2,alpha:.3},l.duration=220,l.delay=r,l.callBack=function(){ObjectPool.push(i),i.visible=!1},l.start()},e}(egret.DisplayObjectContainer);egret.registerClass(FloatScore,"FloatScore");var Label=function(t){function e(){t.call(this),this.fontFamily=GameData.font,this.textAlign="center"}__extends(e,t);var i=(__define,e),s=i.prototype;return s.$setText=function(e){return t.prototype.$setText.call(this,e),this.anchorOffsetX=this.anchorX*this.width,this.anchorOffsetY=this.anchorY*this.height,!0},e}(egret.TextField);egret.registerClass(Label,"Label");var MoveInfo=function(){function t(t,e,i){this.tileData=t.clone(),this.target=e,this.duration=i}var e=(__define,t);e.prototype;return t}();egret.registerClass(MoveInfo,"MoveInfo");var Vector2=function(){function t(t,e){this.x=t,this.y=e}var e=(__define,t),i=e.prototype;return i.clone=function(){return new t(this.x,this.y)},i.equalTo=function(t){return t.x==this.x&&t.y==this.y?!0:!1},i.borderUpon=function(t){return Math.abs(t.x-this.x)<=1&&Math.abs(t.y-this.y)<=1?!0:!1},t}();egret.registerClass(Vector2,"Vector2");var LoadingCmd=function(){function t(){}var e=(__define,t);e.prototype;return t.SET_PROGRESS="set_progress",t}();egret.registerClass(LoadingCmd,"LoadingCmd");var LoadingController=function(t){function e(e){t.call(this,e),ControllerManager.instance.register(ControllerID.Loading,this),this.registerFunc(LoadingCmd.SET_PROGRESS,this.setProgress,this)}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.setProgress=function(t,e){this.scene.setProgress(t,e)},i(n,"scene",function(){return this._scene}),e}(BaseController);egret.registerClass(LoadingController,"LoadingController");var LoadingScene=function(t){function e(){t.call(this),this._controller=new LoadingController(this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.setProgress=function(t,e){},s.onResize=function(){},s.open=function(){this.visible=!0},s.close=function(){this.visible=!1},e}(BaseScene);egret.registerClass(LoadingScene,"LoadingScene");var ControllerManager=function(){function t(){this._modules={}}var e=__define,i=t,s=i.prototype;return s.clear=function(){this._modules={}},s.register=function(t,e){this.isExists(t)||(this._modules[t]=e)},s.unregister=function(t){this.isExists(t)&&(this._modules[t]=null,delete this._modules[t])},s.isExists=function(t){return null!=this._modules[t]},s.applyFunc=function(t,e){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];var n=this._modules[t];if(n){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];return n.applyFunc.apply(n,r)}return Log.trace("模块"+t+"不存在"),null},s.getControllerModel=function(t){var e=this._modules[t];return e?e.getModel():null},e(t,"instance",function(){return this._instance||(this._instance=new t)}),t}();egret.registerClass(ControllerManager,"ControllerManager");var ControllerID;!function(t){t[t.Loading=0]="Loading",t[t.Menu=1]="Menu",t[t.Game=2]="Game",t[t.Grid=3]="Grid"}(ControllerID||(ControllerID={}));var SceneManager=function(){function t(){this._opens=[],this._scenes={}}var e=__define,i=t,s=i.prototype;return s.open=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var s=this._scenes[t];if(!s){switch(t){case SceneID.Loading:s=ObjectPool.pop("LoadingScene");break;case SceneID.Menu:s=ObjectPool.pop("MenuScene");break;case SceneID.Game:s=ObjectPool.pop("GameScene");break;default:return void Log.trace("Scene_"+t+"不存在")}this._scenes[t]=s,StageUtils.stage.addChild(s)}return s.open(e),this._opens.indexOf(t)<0&&this._opens.push(t),s},s.close=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(!(this._opens.indexOf(t)<0)){var s=this._scenes[t];s&&(ArrayUtils.remove(this._opens,t),s.close(e))}},s.getScene=function(t){return this._scenes[t]},s.closeAll=function(){for(;this._opens.length;)this.close(this._opens[0])},e(t,"instance",function(){return this._instance||(this._instance=new t)}),t}();egret.registerClass(SceneManager,"SceneManager");var SceneID;!function(t){t[t.Loading=0]="Loading",t[t.Menu=1]="Menu",t[t.Game=2]="Game"}(SceneID||(SceneID={}));var AnchorUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.init=function(){this._propertyChange=Object.create(null),this._anchorChange=Object.create(null),this.injectAnchor()},t.setAnchorX=function(t,e){t.anchorX=e},t.setAnchorY=function(t,e){t.anchorY=e},t.setAnchor=function(t,e){t.anchorX=t.anchorY=e},t.getAnchor=function(t){return t.anchorX!=t.anchorY&&console.log("target's anchorX != anchorY"),t.anchorX||0},t.getAnchorY=function(t){return t.anchorY||0},t.getAnchorX=function(t){return t.anchorX||0},t.injectAnchor=function(){Object.defineProperty(egret.DisplayObject.prototype,"width",{get:function(){return this.$getWidth()},set:function(e){var i=this;this.$setWidth(e),t._propertyChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"height",{get:function(){return this.$getHeight()},set:function(e){var i=this;this.$setHeight(e),t._propertyChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorX",{get:function(){return this._anchorX},set:function(e){var i=this;this._anchorX=e,t._propertyChange[this.hashCode]=!0,t._anchorChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorY",{get:function(){return this._anchorY},set:function(e){var i=this;this._anchorY=e,t._propertyChange[this.hashCode]=!0,t._anchorChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(i)},this)},enumerable:!0,configurable:!0})},t.changeAnchor=function(t){this._propertyChange[t.hashCode]&&this._anchorChange[t.hashCode]&&(t.anchorOffsetX=t._anchorX*t.width,t.anchorOffsetY=t._anchorY*t.height,delete this._propertyChange[t.hashCode])},t}();egret.registerClass(AnchorUtils,"AnchorUtils");var ArrayUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.forEach=function(t,e,i){for(var s=0,n=t.length;n>s;s++)e.apply(i,[t[s]])},t.remove=function(t,e){var i=t.indexOf(e);t.splice(i,1)},t}();egret.registerClass(ArrayUtils,"ArrayUtils");var DateUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.getFormatBySecond=function(t,e){void 0===e&&(e=1);var i="";switch(e){case 1:i=this.getFormatBySecond1(t);break;case 2:i=this.getFormatBySecond2(t);break;case 3:i=this.getFormatBySecond3(t);break;case 4:i=this.getFormatBySecond4(t);break;case 5:i=this.getFormatBySecond5(t)}return i},t.getFormatBySecond1=function(t){void 0===t&&(t=0);var e,i=Math.floor(t/3600);e=0==i?"00":10>i?"0"+i:""+i;var s,n,r=Math.floor((t-3600*i)/60),a=Math.floor((t-3600*i)%60);return s=0==r?"00":10>r?"0"+r:""+r,n=0==a?"00":10>a?"0"+a:""+a,e+":"+s+":"+n},t.getFormatBySecond3=function(t){void 0===t&&(t=0);var e,i,s=Math.floor(t/3600),n=Math.floor((t-3600*s)/60),r=Math.floor((t-3600*s)%60);return e=0==n?"00":10>n?"0"+n:""+n,i=0==r?"00":10>r?"0"+r:""+r,e+":"+i},t.getFormatBySecond2=function(t){var e=new Date(t),i=e.getFullYear(),s=e.getMonth()+1,n=e.getDate(),r=e.getHours(),a=e.getMinutes(),o=e.getSeconds();return i+"-"+s+"-"+n+" "+r+":"+a+":"+o},t.getFormatBySecond4=function(t){var e=Math.floor(t/3600);return e>0?e>24?Math.floor(e/24)+"天前":e+"小时前":Math.floor(t/60)+"分钟前"},t.getFormatBySecond5=function(t){var e=86400,i=3600,s=60,n=Math.floor(t/e),r=Math.floor(t%e/i),a=Math.floor((t-r*i)/s),o=Math.floor((t-r*i)%s),h="",l="",c="",u="";return t>0?0==n?(h="",0==r?(l="",0==a?(c="",u=0==o?"":10>o?"0"+o+"秒":""+o+"秒"):(c=""+a+"分",u=0==o?"":10>o?"0"+o+"秒":""+o+"秒",c+u)):(l=r+"小时",0==a?(c="",u=0==o?"":10>o?"0"+o+"秒":""+o+"秒"):(c=10>a?"0"+a+"分":""+a+"分",l+c))):(h=n+"天",l=0==r?"":10>r?"0"+r+"小时":""+r+"小时",h+l):""},t}();egret.registerClass(DateUtils,"DateUtils");var DebugUtils=function(){function t(){}var e=__define,i=t;i.prototype;return t.isOpen=function(t){this._isOpen=t},e(t,"isDebug",function(){return this._isOpen}),t.start=function(t){this._isOpen&&(this._startTimes[t]=egret.getTimer())},t.stop=function(t){if(!this._isOpen)return 0;if(!this._startTimes[t])return 0;var e=egret.getTimer()-this._startTimes[t];return e>this._threshold&&this.log(t+": "+e),e},t.setThreshold=function(t){this._threshold=t},t.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this._isOpen&&(t[0]="[DebugLog]"+t[0],console.log.apply(console,t))},t._isOpen=!1,t._startTimes={},t._threshold=3,t}();egret.registerClass(DebugUtils,"DebugUtils");var DeviceUtils=function(){function t(){}var e=__define,i=t;i.prototype;return e(t,"IsHtml5",function(){return egret.Capabilities.runtimeType==egret.RuntimeType.WEB}),e(t,"IsNative",function(){return egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE}),e(t,"IsMobile",function(){return egret.Capabilities.isMobile}),e(t,"IsPC",function(){return!egret.Capabilities.isMobile}),e(t,"IsQQBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MQQBrowser")}),e(t,"IsIEBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MSIE")}),e(t,"IsFirefoxBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Firefox")}),e(t,"IsChromeBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Chrome")}),e(t,"IsSafariBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Safari")}),e(t,"IsOperaBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Opera")}),t}();egret.registerClass(DeviceUtils,"DeviceUtils");var DisplayUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.createBitmap=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},t.removeFromParent=function(t){null!=t.parent&&t.parent.removeChild(t)},t}();egret.registerClass(DisplayUtils,"DisplayUtils");var DrawUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.drawRoundHexagon=function(t,e,i,s){var n=t.graphics;n.clear(),n.lineStyle(i,s),n.beginFill(s),e-=Math.ceil(i/2),n.moveTo(-e/2,-e*Math.sqrt(3)/2),n.lineTo(e/2,-e*Math.sqrt(3)/2),n.lineTo(e,0),n.lineTo(e/2,e*Math.sqrt(3)/2),n.lineTo(-e/2,e*Math.sqrt(3)/2),n.lineTo(-e,0),n.lineTo(-e/2,-e*Math.sqrt(3)/2),n.endFill()},t.drawRect=function(t,e,i,s){var n=t.graphics;n.clear(),n.beginFill(s),n.drawRect(0,0,e,i),n.endFill()},t.drawRoundRect=function(t,e,i,s,n,r){var a=t.graphics;a.clear(),a.beginFill(r),a.drawRoundRect(0,0,e,i,s,n),a.endFill()},t.drawHollowRect=function(t,e,i,s,n){var r=t.graphics;r.clear(),r.lineStyle(s,n),r.moveTo(s/2,s/2),r.lineTo(e+s/2,s/2),r.lineTo(e+s/2,i+s/2),r.lineTo(s/2,i+s/2),r.lineTo(s/2,s/2)},t.drawTriangle=function(t,e,i,s){var n=t.graphics;n.clear(),n.lineStyle(i,s);var r=function(t){return e*Math.cos((60*t+30)/180*Math.PI)},a=function(t){return e*Math.sin((60*t+30)/180*Math.PI)};n.moveTo(r(0),a(0)),n.lineTo(r(2),a(2)),n.lineTo(r(4),a(4)),n.lineTo(r(0),a(0))},t.drawStar=function(t,e,i,s){var n=t.graphics;n.clear(),n.lineStyle(i,s);var r=function(t){return e*Math.cos((72*t-18)/180*Math.PI)},a=function(t){return e*Math.sin((72*t-18)/180*Math.PI)};n.moveTo(r(0),a(0)),n.lineTo(r(2),a(2)),n.lineTo(r(4),a(4)),n.lineTo(r(1),a(1)),n.lineTo(r(3),a(3)),n.lineTo(r(0),a(0))},t.drawCross=function(t,e,i,s){var n=t.graphics;n.clear(),n.lineStyle(i,s),n.moveTo(-e/2,0),n.lineTo(e/2,0),n.moveTo(0,-e/2),n.lineTo(0,e/2)},t.drawMi=function(t,e,i,s){var n=t.graphics;n.clear(),n.lineStyle(i,s),n.moveTo(-e/2,0),n.lineTo(e/2,0),n.moveTo(0,-e/2),n.lineTo(0,e/2);var r=Math.sin(Math.PI/4);n.moveTo(e/2*-r,e/2*-r),n.lineTo(e/2*r,e/2*r),n.moveTo(e/2*-r,e/2*r),n.lineTo(e/2*r,e/2*-r)},t.drawCircle=function(t,e,i){var s=t.graphics;s.clear(),s.beginFill(i),s.drawCircle(0,0,e),s.endFill()},t.drawLine=function(t,e,i,s,n){var r=t.graphics;r.clear(),r.lineStyle(s,n),r.moveTo(e.x,e.y),r.lineTo(i.x,i.y),t.graphics.endFill()},t}();egret.registerClass(DrawUtils,"DrawUtils");var Utils=function(){function t(){}var e=(__define,t);e.prototype;return t.macIconShake=function(t,e){for(var i=[[20,300],[15,300],[10,300],[5,300]],s="egret.Tween.get("+t+")",n=0,r=i.length;r>n;n++)s+=".to({'y':"+e+"-"+i[n][0]+"}, "+i[n][1]+")",s+=".to({'y':"+e+"}, "+i[n][1]+")";return s+=";"},t.startFlicker=function(t,e){t.alpha=1,egret.Tween.get(t).to({alpha:0},e).to({alpha:1},e).call(this.startFlicker,this,[t])},t.stopFlicker=function(t){egret.Tween.removeTweens(t)},t}();egret.registerClass(Utils,"Utils");var FrameExecutor=function(){function t(t){this.delayFrame=t,this.frameDelay=new FrameDelay,this.functions=new Array}var e=(__define,t),i=e.prototype;return i.regist=function(t,e){this.functions.push([t,e])},i.execute=function(){if(this.functions.length){var t=this.functions.shift();t[0].call(t[1]),this.frameDelay.delayCall(this.delayFrame,this.execute,this)}},t}();egret.registerClass(FrameExecutor,"FrameExecutor");var FrameDelay=function(){function t(){}var e=(__define,t),i=e.prototype;return i.delayCall=function(t,e,i){this.func=e,this.thisObj=i,TimerManager.doFrame(t,1,this.listener_enterFrame,this)},i.listener_enterFrame=function(){this.func.call(this.thisObj)},t}();egret.registerClass(FrameDelay,"FrameDelay");var KeyboardUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.init=function(){if(this.key_ups=new Array,this.key_downs=new Array,DeviceUtils.IsHtml5){var t=this;document.addEventListener("keyup",function(e){for(var i=0,s=t.key_ups.length;s>i;i++){var n=t.key_ups[i][0],r=t.key_ups[i][1];r?n.call(r,e.keyCode):n(e.keyCode)}}),document.addEventListener("keydown",function(e){for(var i=0,s=t.key_downs.length;s>i;i++){var n=t.key_downs[i][0],r=t.key_downs[i][1];r?n.call(r,e.keyCode):n(e.keyCode)}})}},t.addKeyUp=function(t,e){this.key_ups.push([t,e])},t.addKeyDown=function(t,e){this.key_downs.push([t,e])},t.removeKeyUp=function(t,e){for(var i=0;i<this.key_ups.length;i++)this.key_ups[i][0]==t&&this.key_ups[i][1]==e&&(this.key_ups.splice(i,1),i--)},t.removeKeyDown=function(t,e){for(var i=0;i<this.key_downs.length;i++)this.key_downs[i][0]==t&&this.key_downs[i][1]==e&&(this.key_downs.splice(i,1),i--)},t}();egret.registerClass(KeyboardUtils,"KeyboardUtils");var Keyboard=function(){function t(){}var e=(__define,t);e.prototype;return t.LEFT=37,t.RIGHT=39,t.UP=38,t.DOWN=40,t.W=87,t.A=65,t.S=83,t.D=68,t.J=74,t.K=75,t.L=76,t.U=85,t.I=73,t.O=79,t.P=80,t.SPACE=32,t}();egret.registerClass(Keyboard,"Keyboard");var Log=function(){function t(){}var e=(__define,t);e.prototype;return t.trace=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];DebugUtils.isDebug&&(t[0]="[DebugLog]"+t[0],console.log.apply(console,t))},t}();egret.registerClass(Log,"Log");var MathUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.getAngle=function(t){return 180*t/Math.PI},t.getRadian=function(t){return Math.PI=t/180*Math.PI},t.getRadian2=function(t,e,i,s){var n=i-t,r=s-e;return Math.atan2(r,n)},t.getDistance=function(t,e,i,s){var n=i-t,r=s-e,a=n*n+r*r;return Math.sqrt(a)},t.log=function(t,e){for(var i=0;(e=Math.floor(e/t))>0;)i+=1;return i},t}();egret.registerClass(MathUtils,"MathUtils");var MazeUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.findPath=function(t,e,i){for(this._openList=[],this._closeList=[],this._mazeList=t,this._openList.push(e);this._openList.length>0;){this._openList.sort(this.sortF);var s=this._openList.shift();this._closeList.push(s);for(var n=this.getAroundPoint(s),r=0;r<n.length;r++){var a=n[r];this.getInOpenList(a)?this.recalcPoint(s,a):this.addPoint(s,i,a)}if(this.getInOpenList(i))return this.getInOpenList(i)}return this.getInOpenList(i)?this.getInOpenList(i):void 0},t.sortF=function(t,e){return t.F-e.F},t.getInOpenList=function(t){for(var e=this._openList,i=0;i<e.length;i++){var s=e[i];if(s.X==t.X&&s.Y==t.Y)return s}},t.getInCloseList=function(t){for(var e=this._closeList,i=0;i<e.length;i++){var s=e[i];if(s.X==t.X&&s.Y==t.Y)return s}},t.getAroundPoint=function(t){for(var e=[],i=-1;1>=i;i++)for(var s=-1;1>=s;s++)if(0!=i||0!=s){var n=!1;if(t.X%2==0?(0==i||s>=0)&&(n=!0):(0==i||0>=s)&&(n=!0),n){var r=new Point(t.X+i,t.Y+s);this.canReach(r)&&e.push(r)}}return e},t.addPoint=function(t,e,i){i.parent=t,i.G=this.calcG(t,i),i.H=this.calcH(e,i),this._openList.push(i)},t.recalcPoint=function(t,e){var i=this.calcG(t,e);i<e.G&&(e.parent=t,e.G=i)},t.calcG=function(t,e){var i=e.parent?e.parent.G:0;return i+1},t.calcH=function(t,e){return Math.abs(t.X-e.X)+Math.abs(t.Y-e.Y)},t.canReach=function(t){var e=t.X,i=t.Y,s=this._mazeList;return!this.getInCloseList(t)&&e>=0&&s.length>e&&i>=0&&s[e].length>i&&0==s[e][i]},t}();egret.registerClass(MazeUtils,"MazeUtils");var Point=function(){function t(t,e){this.G=0,this.H=0,this.X=t,this.Y=e}var e=__define,i=t,s=i.prototype;return e(s,"F",function(){return this.G+this.H
}),t}();egret.registerClass(Point,"Point");var ObjectPool=function(){function t(){}var e=(__define,t);e.prototype;return t.pop=function(e){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];t._content[e]||(t._content[e]=[]);var n=t._content[e];if(n.length)return n.pop();var r,a=egret.getDefinitionByName(e),o=i.length;return 0==o?r=new a:1==o?r=new a(i[0]):2==o?r=new a(i[0],i[1]):3==o?r=new a(i[0],i[1],i[2]):4==o?r=new a(i[0],i[1],i[2],i[3]):5==o&&(r=new a(i[0],i[1],i[2],i[3],i[4])),r.ObjectPoolKey=e,r},t.popWithExtraKey=function(e,i){t._content[e]||(t._content[e]=[]);var s,n=t._content[e];if(n.length)for(var r=0;r<n.length;r++)if(n[r].extraKey==i){s=n[r],n.splice(r,1);break}if(!s){var a=egret.getDefinitionByName(e);s=new a(i),s.extraKey=i,s.ObjectPoolKey=e}return s},t.push=function(e){if(null==e)return!1;var i=e.ObjectPoolKey,s=t._content[i];return!s||s.indexOf(e)>=0?!1:(t._content[i].push(e),!0)},t.clear=function(){t._content={}},t.clearClass=function(e,i){void 0===i&&(i=null);for(var s=t._content[e];s&&s.length;){var n=s.pop();i&&n[i](),n=null}t._content[e]=null,delete t._content[e]},t.dealFunc=function(e,i){var s=t._content[e];if(null!=s){var n=0,r=s.length;for(n;r>n;n++)s[n][i]()}},t._content={},t}();egret.registerClass(ObjectPool,"ObjectPool");var RandomUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.limit=function(t,e){t=Math.min(t,e),e=Math.max(t,e);var i=e-t;return t+Math.random()*i},t.limitInteger=function(t,e){return Math.floor(this.limit(t,e+1))},t.randomArray=function(t){var e=Math.floor(Math.random()*t.length);return t[e]},t}();egret.registerClass(RandomUtils,"RandomUtils");var Rocker=function(){function t(){}var e=(__define,t),i=e.prototype;return i.init=function(t,e,i,s){this.keys=[0,0],this.mouseX=-1,this.mouseY=-1,this.moveFlag=e,this.moveFlagX=e.x,this.moveFlagY=e.y,this.moveFlagGoX=this.moveFlagX,this.moveFlagGoY=this.moveFlagY,this.moveFlagWidthHelf=.5*t.width,this.moveFlagRec=new egret.Rectangle(this.moveFlagX-.5*t.width,this.moveFlagY-.5*t.height,t.width,t.height),this.moveFlagCheckRec=new egret.Rectangle(0,0,.5*StageUtils.stageW,StageUtils.stageH),this.dealKeyFunc=i,this.dealKeyTarget=s,this.moveFlag.touchEnabled=!0,this.moveFlag.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.startMove,this),this.moveFlag.addEventListener(egret.TouchEvent.TOUCH_END,this.stopMove,this),this.moveFlag.addEventListener(egret.TouchEvent.TOUCH_TAP,this.stopEvent,this),StageUtils.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.leaveStateEvent,this),StageUtils.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.heroMoveEvent,this),KeyboardUtils.addKeyDown(this.onKeyDown,this),KeyboardUtils.addKeyUp(this.onKeyUp,this)},i.onKeyDown=function(t){switch(t){case Keyboard.A:this.keys[0]=-1,this.startCheckKey();break;case Keyboard.D:this.keys[0]=1,this.startCheckKey();break;case Keyboard.W:this.keys[1]=-1,this.startCheckKey();break;case Keyboard.S:this.keys[1]=1,this.startCheckKey()}},i.onKeyUp=function(t){switch(t){case Keyboard.A:-1==this.keys[0]&&(this.keys[0]=0);break;case Keyboard.D:1==this.keys[0]&&(this.keys[0]=0);break;case Keyboard.W:-1==this.keys[1]&&(this.keys[1]=0);break;case Keyboard.S:1==this.keys[1]&&(this.keys[1]=0)}},i.stopEvent=function(t){t.stopPropagation()},i.leaveStateEvent=function(t){t.stageX==this.mouseX&&t.stageY==this.mouseY&&this.stopMove()},i.startMove=function(t){this.isMoveing=!0,this.moveFlagGoX=this.moveFlagX,this.moveFlagGoY=this.moveFlagY,this.mouseX=t.stageX,this.mouseY=t.stageY},i.stopMove=function(){this.isMoveing=!1,this.keys[0]=0,this.keys[1]=0,this.moveFlagGoX=this.moveFlagX,this.moveFlagGoY=this.moveFlagY,this.mouseX=-1,this.mouseY=-1},i.resetRockerPos=function(){this.moveFlag.x=this.moveFlagX,this.moveFlag.y=this.moveFlagY},i.heroMoveEvent=function(t){this.runMove(t.stageX,t.stageY)},i.runMove=function(t,e){if(this.isMoveing&&(this.moveFlagCheckRec.contains(t,e)||!(Math.abs(this.mouseX-t)>50||Math.abs(this.mouseY-e)>50))){if(this.mouseX=t,this.mouseY=e,this.moveFlagRec.contains(this.mouseX,this.mouseY))this.moveFlagGoX=this.mouseX,this.moveFlagGoY=this.mouseY;else{var i=MathUtils.getRadian2(this.moveFlagX,this.moveFlagY,this.mouseX,this.mouseY);this.moveFlagGoX=this.moveFlagX+Math.cos(i)*this.moveFlagWidthHelf,this.moveFlagGoY=this.moveFlagY+Math.sin(i)*this.moveFlagWidthHelf}this.moveFlagGoX>this.moveFlagX&&Math.abs(this.moveFlagGoX-this.moveFlagX)>10?this.keys[0]=1:this.moveFlagGoX<this.moveFlagX&&Math.abs(this.moveFlagGoX-this.moveFlagX)>10?this.keys[0]=-1:this.keys[0]=0,this.moveFlagGoY>this.moveFlagY&&Math.abs(this.moveFlagGoY-this.moveFlagY)>10?this.keys[1]=1:this.moveFlagGoY<this.moveFlagY&&Math.abs(this.moveFlagGoY-this.moveFlagY)>10?this.keys[1]=-1:this.keys[1]=0,this.startCheckKey()}},i.startCheckKey=function(){this.checkKeying||(this.checkKeying=!0,TimerManager.doFrame(1,0,this.delKeys,this))},i.stopCheckKey=function(){this.keys[0]=0,this.keys[1]=0,this.checkKeying&&(TimerManager.remove(this.delKeys,this),this.checkKeying=!1)},i.delKeys=function(){-1==this.mouseX||this.moveFlagCheckRec.contains(this.mouseX,this.mouseY)||this.stopMove(),this.moveFlag.x!=this.moveFlagGoX&&(this.moveFlag.x=this.moveFlagGoX),this.moveFlag.y!=this.moveFlagGoY&&(this.moveFlag.y=this.moveFlagGoY),this.keys[0]||this.keys[1]||this.stopCheckKey(),this.dealKeyFunc.call(this.dealKeyTarget,this.keys[0],this.keys[1])||this.resetRockerPos()},i.stop=function(){this.stopCheckKey(),this.stopMove()},t}();egret.registerClass(Rocker,"Rocker");var ShockUtils=function(){function t(){}var e=__define,i=t;i.prototype;return t.destroy=function(){this.stop()},t.shock=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=null),void 0===i&&(i=3),this._target||(this._type=t,this._target=e,this._type==this.MAP?(this._shockPoss=this.mapPoss.concat(),this._shockLength=this._shockPoss.length):this._type==this.SPRITE&&(this._shockPoss=this.spritePoss.concat(),this._shockLength=this._shockPoss.length),this.start(i))},t.start=function(t){void 0===t&&(t=1),this.repeatCount=t,this._shockCount=0,this._target&&(this._type!=this.MAP&&(this._rx=this._target.x),this._ry=this._target.y,TimerManager.doFrame(1,0,this.onShockEnter,this))},t.stop=function(){this._target&&(this._type!=this.MAP&&(this._target.x=this._rx),this._target.y=this._ry,TimerManager.remove(this.onShockEnter,this)),this._target=null},t.onShockEnter=function(t){var e=this._shockLength*this._repeatCount;if(this._shockCount>=e)return void this.stop();var i=this._shockCount%this._shockLength,s=this._shockPoss[i];this._target&&(this._type!=this.MAP&&(this._target.x=this._rx+s.x),this._target.y=this._ry+s.y),this._shockCount++},e(t,"repeatCount",function(){return this._repeatCount},function(t){this._repeatCount=t}),t.MAP=0,t.SPRITE=1,t.mapPoss=[new egret.Point(0,3),new egret.Point(0,0),new egret.Point(0,-2)],t.spritePoss=[new egret.Point(5,0),new egret.Point(-5,0),new egret.Point(5,0)],t._shockLength=0,t._shockCount=0,t._rx=0,t._ry=0,t._type=0,t._repeatCount=0,t}();egret.registerClass(ShockUtils,"ShockUtils");var SortUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.sortNum=function(t,e){return t-e},t.random=function(t,e){return Math.random()-.5},t}();egret.registerClass(SortUtils,"SortUtils");var StageUtils=function(){function t(){}var e=__define,i=t;i.prototype;return e(t,"stage",function(){return egret.MainContext.instance.stage}),e(t,"stageW",function(){return egret.MainContext.instance.stage.stageWidth}),e(t,"stageH",function(){return egret.MainContext.instance.stage.stageHeight}),t}();egret.registerClass(StageUtils,"StageUtils");var StringUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.trimSpace=function(t){return t.replace(/^\s*(.*?)[\s\n]*$/g,"$1")},t.getStringLength=function(t){for(var e=t.split(""),i=0,s=0;s<e.length;s++){var n=e[s];i+=this.isChinese(n)?2:1}return i},t.isChinese=function(t){var e=/^.*[\u4E00-\u9FA5]+.*$/;return e.test(t)},t}();egret.registerClass(StringUtils,"StringUtils");var TextFlowMaker=function(){function t(){}var e=(__define,t);e.prototype;return t.generateTextFlow=function(t){for(var e=t.split("|"),i=[],s=0,n=e.length;n>s;s++)i.push(this.getSingleTextFlow(e[s]));return i},t.getSingleTextFlow=function(t){for(var e,i=t.split("&"),s={style:{}},n=0,r=i.length;r>n;n++)e=i[n].split(":"),e[0]==this.PROP_TEXT?s.text=e[1]:e[0]==this.STYLE_SIZE?s.style.size=parseInt(e[1]):e[0]==this.STYLE_COLOR?s.style.textColor=parseInt(e[1]):s.text=e[0];return s},t.STYLE_COLOR="C",t.STYLE_SIZE="S",t.PROP_TEXT="T",t}();egret.registerClass(TextFlowMaker,"TextFlowMaker");var TimerManager=function(){function t(){}var e=__define,i=t;i.prototype;return t.init=function(){this._handlers=new Array,this._delHandlers=new Array,this._currTime=egret.getTimer(),this._currFrame=0,this._count=0,this._timeScale=1,egret.Ticker.getInstance().register(this.onEnterFrame,this)},t.setTimeScale=function(t){this._timeScale=t},t.getTimeScale=function(){return this._timeScale},t.onEnterFrame=function(){this._currFrame++,this._currTime=egret.getTimer(),DebugUtils.start("TimerManager:");for(var t=0;t<this._count;t++){var e=this._handlers[t],i=e.userFrame?this._currFrame:this._currTime;i>=e.exeTime&&(DebugUtils.start(e.method.toString()),e.method.call(e.methodObj,(this._currTime-e.dealTime)*this._timeScale),DebugUtils.stop(e.method.toString()),e.dealTime=this._currTime,e.exeTime+=e.delay,e.repeat||(e.repeatCount>1?e.repeatCount--:(e.complateMethod&&e.complateMethod.apply(e.complateMethodObj),this._delHandlers.push(e))))}for(;this._delHandlers.length;){var e=this._delHandlers.pop();this.remove(e.method,e.methodObj)}DebugUtils.stop("TimerManager:")},t.create=function(t,e,i,s,n,r,a){if(!(0>e||0>i||null==s)){this.remove(s,n);var o=ObjectPool.pop("TimerHandler");o.userFrame=t,o.repeat=0==i,o.repeatCount=i,o.delay=e,o.method=s,o.methodObj=n,o.complateMethod=r,o.complateMethodObj=a,o.exeTime=e+(t?this._currFrame:this._currTime),o.dealTime=this._currTime,this._handlers.push(o),this._count++}},t.doTimer=function(t,e,i,s,n,r){void 0===n&&(n=null),void 0===r&&(r=null),this.create(!1,t,e,i,s,n,r)},t.doFrame=function(t,e,i,s,n,r){void 0===n&&(n=null),void 0===r&&(r=null),this.create(!0,t,e,i,s,n,r)},e(t,"count",function(){return this._count}),t.remove=function(t,e){for(var i=0;i<this._count;i++){var s=this._handlers[i];if(s.method==t&&s.methodObj==e){this._handlers.splice(i,1),ObjectPool.push(s),this._count--;break}}},t.removeAll=function(t){for(var e=0;e<this._count;e++){var i=this._handlers[e];i.methodObj==t&&(this._handlers.splice(e,1),ObjectPool.push(i),this._count--,e--)}},t.isExists=function(t,e){for(var i=0;i<this._count;i++){var s=this._handlers[i];if(s.method==t&&s.methodObj==e)return!0}return!1},t}();egret.registerClass(TimerManager,"TimerManager");var TimerHandler=function(){function t(){this.delay=0,this.repeatCount=0,this.exeTime=0,this.dealTime=0}var e=(__define,t),i=e.prototype;return i.clear=function(){this.method=null,this.methodObj=null,this.complateMethod=null,this.complateMethodObj=null},t}();egret.registerClass(TimerHandler,"TimerHandler");var TweenManager=function(){function t(){}var e=(__define,t);e.prototype;return t.init=function(){this.time=0,this.tweens=[],TimerManager.doFrame(1,0,this.update,this)},t.update=function(t){this.time+=t;for(var e=0;e<this.tweens.length;e++)this.tweens[e].update(t)},t.add=function(t){this.tweens.push(t)},t.remove=function(t){ArrayUtils.remove(this.tweens,t)},t.removeTween=function(t){for(var e=0;e<this.tweens.length;e++)this.tweens[e].obj.hashCode==t.hashCode&&this.tweens[e].stop()},t}();egret.registerClass(TweenManager,"TweenManager");var Tween=function(){function t(t,e){void 0===e&&(e=null),this.obj=t,e?(this.from=e.from,this.to=e.to,this.duration=e.duration,this.delay=e.delay,this.ease=e.ease,this.loop=e.loop):(this.from={},this.to={},this.duration=0,this.delay=0,this.ease=TweenEase.Linear,this.loop=!1)}var e=(__define,t),i=e.prototype;return i.start=function(){this.time=0,TweenManager.add(this)},i.begin=function(){var t=this.from,e=this.to,i=this.obj;for(var s in e)null==t[s]&&null!=i[s]&&(t[s]=i[s]);for(var s in t)i[s]=t[s]},i.end=function(){var t=this.to,e=this.obj;for(var i in t)e[i]=t[i];this.callBack&&this.callBack()},i.update=function(t){if(null==this.obj.parent)return void this.stop();var e=this.time<=this.delay;this.time+=t;var i=(this.time-this.delay)/this.duration;if(i>0){if(i>=1)return this.time-=this.duration,this.loop||this.stop(),this.end(),void(this.loop&&this.begin());e&&this.begin();var s=this.ease(i);for(var n in this.to){var r=this.from[n],a=this.to[n];null!=r&&null!=a&&(this.obj[n]=(a-r)*s+r)}this.updateFunc&&this.updateFunc(this.time)}},i.stop=function(){TweenManager.remove(this)},t}();egret.registerClass(Tween,"Tween");var TweenEase=function(){function t(){}var e=(__define,t);e.prototype;return t.Linear=function(t){return t},t.QuadIn=function(t){return t*t},t.QuadOut=function(t){return-(t*(t-2))},t.QuadInOut=function(t){return.5>t?2*t*t:-2*t*t+4*t-1},t.CubicIn=function(t){return t*t*t},t.CubicOut=function(t){var e=t-1;return e*e*e+1},t.CubicInOut=function(t){if(.5>t)return 4*t*t*t;var e=2*t-2;return.5*e*e*e+1},t.QuartIn=function(t){return t*t*t*t},t.QuartOut=function(t){var e=t-1;return e*e*e*(1-t)+1},t.QuartInOut=function(t){if(.5>t)return 8*t*t*t*t;var e=t-1;return-8*e*e*e*e+1},t.QuinIn=function(t){return t*t*t*t*t},t.QuinOut=function(t){var e=t-1;return e*e*e*e*e+1},t.QuinInOut=function(t){if(.5>t)return 16*t*t*t*t*t;var e=2*t-2;return.5*e*e*e*e*e+1},t.SineIn=function(t){return Math.sin((t-1)*Math.PI/2)+1},t.SineOut=function(t){return Math.sin(t*Math.PI/2)},t.SineInOut=function(t){return.5*(1-Math.cos(t*Math.PI))},t.CircIn=function(t){return 1-Math.sqrt(1-t*t)},t.CircOut=function(t){return Math.sqrt((2-t)*t)},t.CircInOut=function(t){return.5>t?.5*(1-Math.sqrt(1-4*(t*t))):.5*(Math.sqrt(-(2*t-3)*(2*t-1))+1)},t.ExpoIn=function(t){return 0==t?t:Math.pow(2,10*(t-1))},t.ExpoOut=function(t){return 1==t?t:1-Math.pow(2,-10*t)},t.ExpoInOut=function(t){return 0==t||1==t?t:.5>t?.5*Math.pow(2,20*t-10):-.5*Math.pow(2,-20*t+10)+1},t.ElasticIn=function(t){return Math.sin(13*Math.PI/2*t)*Math.pow(2,10*(t-1))},t.ElasticOut=function(t){return Math.sin(-13*Math.PI/2*(t+1))*Math.pow(2,-10*t)+1},t.ElasticInOut=function(t){return.5>t?.5*Math.sin(13*Math.PI/2*(2*t))*Math.pow(2,10*(2*t-1)):.5*(Math.sin(-13*Math.PI/2*(2*t-1+1))*Math.pow(2,-10*(2*t-1))+2)},t.BackIn=function(t){return t*t*t-t*Math.sin(t*Math.PI)},t.BackOut=function(t){var e=1-t;return 1-(e*e*e-e*Math.sin(e*Math.PI))},t.BackInOut=function(t){if(.5>t){var e=2*t;return.5*(e*e*e-e*Math.sin(e*Math.PI))}var e=1-(2*t-1);return.5*(1-(e*e*e-e*Math.sin(e*Math.PI)))+.5},t.BounceIn=function(t){return 1-this.BounceOut(1-t)},t.BounceOut=function(t){return 4/11>t?121*t*t/16:8/11>t?9.075*t*t-9.9*t+3.4:.9>t?4356/361*t*t-35442/1805*t+16061/1805:10.8*t*t-20.52*t+10.72},t.BounceInOut=function(t){return.5>t?.5*this.BounceIn(2*t):.5*this.BounceOut(2*t-1)+.5},t.CusIn=function(t){return.375>t?-.1*t/.375:.5>t?-.1:-.1+1.1*(t-.5)*2},t.CusOut=function(t){return.5>t?1.1*t*2:.625>t?1.1:1.1-.1*(t-.625)/.375},t}();egret.registerClass(TweenEase,"TweenEase");